!function(t){"use strict";t(document).ready(function(){var e=t(".mt-evaluation-table");if(!e.length)return;const a=2e3,n=0,o=10,s=.5,i=new Map;let d=new Map;function l(t){return t=Math.round(t/s)*s,Math.max(n,Math.min(o,t))}function r(){e.on("keydown",".mt-eval-score-input",function(e){const a=t(this),n=a.parent(),o=n.parent();let d;switch(e.key){case"ArrowUp":e.preventDefault(),d=o.prev().find("td").eq(n.index()).find(".mt-eval-score-input"),d.length&&d.focus().select();break;case"ArrowDown":e.preventDefault(),d=o.next().find("td").eq(n.index()).find(".mt-eval-score-input"),d.length&&d.focus().select();break;case"ArrowLeft":case"Tab":(e.shiftKey||"ArrowLeft"===e.key)&&(e.preventDefault(),d=n.prev().find(".mt-eval-score-input"),d.length&&d.focus().select());break;case"ArrowRight":e.preventDefault(),d=n.next().find(".mt-eval-score-input"),d.length&&d.focus().select();break;case"Enter":e.preventDefault(),o.find(".mt-btn-save-eval").click();break;case"Escape":!function(t){const e=i.get(t[0]);e&&(Object.keys(e).forEach(a=>{t.find(`input[name="${a}"]`).val(e[a])}),c(t),t.removeClass("unsaved"),t.find(".mt-btn-save-eval").removeClass("unsaved"),i.delete(t[0]))}(o),a.blur()}if("+"===e.key||"="===e.key){e.preventDefault();let t=l(parseFloat(a.val())+s);a.val(t).trigger("input")}else if("-"===e.key||"_"===e.key){e.preventDefault();let t=l(parseFloat(a.val())-s);a.val(t).trigger("input")}})}function c(e){let a=0,n=0;e.find(".mt-eval-score-input").each(function(){const e=parseFloat(t(this).val());isNaN(e)||(a+=e,n++)});const o=n>0?a/n:0,s=e.find(".mt-eval-total-value");parseFloat(s.text())!==o&&s.fadeOut(100,function(){t(this).text(o.toFixed(1)).fadeIn(100)});const i=e.find(".mt-eval-total-score");i.removeClass("score-high score-low score-medium"),o>=8?i.addClass("score-high"):o>=5?i.addClass("score-medium"):o<=3&&i.addClass("score-low"),e.data("total-score",o)}r(),e.find("th[title]").each(function(){const e=t(this),a=e.attr("title");e.hover(function(){const n=t('<div class="mt-enhanced-tooltip"></div>').text(a).appendTo("body"),o=e.offset();n.css({top:o.top-n.outerHeight()-10,left:o.left+e.outerWidth()/2-n.outerWidth()/2}).fadeIn(200)},function(){t(".mt-enhanced-tooltip").fadeOut(200,function(){t(this).remove()})})}),e.on("focus",".mt-eval-score-input",function(){!function(e){if(!i.has(e[0])){const a={};e.find(".mt-eval-score-input").each(function(){const e=t(this);a[e.attr("name")]=e.val()}),i.set(e[0],a)}}(t(this).closest("tr"))}),e.on("input",".mt-eval-score-input",function(){const n=t(this).closest("tr"),o=n.data("candidate-id");c(n),n.addClass("unsaved"),n.find(".mt-btn-save-eval").addClass("unsaved"),d.has(o)&&clearTimeout(d.get(o));const s=setTimeout(()=>{n.hasClass("unsaved")&&n.find(".mt-btn-save-eval").click(),d.delete(o)},a);d.set(o,s),clearTimeout(window.rerankTimer),window.rerankTimer=setTimeout(function(){!function(){const a=e.find("tbody"),n=a.find("tr.mt-eval-row").get();n.sort(function(e,a){const n=parseFloat(t(e).data("total-score")||t(e).find(".mt-eval-total-value").text())||0;return(parseFloat(t(a).data("total-score")||t(a).find(".mt-eval-total-value").text())||0)-n});const o={};n.forEach((e,a)=>{const n=t(e),s=n.data("candidate-id"),i=n.find(".mt-ranking-badge");o[s]=parseInt(i.data("position")||a+1)}),t.each(n,function(e,a){const s=t(a),i=e+1,d=s.data("candidate-id"),l=o[d],r=s.find(".mt-eval-rank").find(".mt-ranking-badge");if(l!==i){r.attr("data-position",i);const e=r.find(".mt-rank-number");e.length&&e.fadeOut(200,function(){t(this).text(i).fadeIn(200)});const a=r.find("svg text");a.length&&a.fadeOut(200,function(){t(this).text(i).fadeIn(200)}),r.removeClass("mt-rank-gold mt-rank-silver mt-rank-bronze mt-rank-standard"),1===i?r.addClass("mt-rank-gold"):2===i?r.addClass("mt-rank-silver"):3===i?r.addClass("mt-rank-bronze"):r.addClass("mt-rank-standard");const n=r.find(".mt-medal-icon");n.length&&(n.removeClass("mt-medal-gold mt-medal-silver mt-medal-bronze"),1===i?n.addClass("mt-medal-gold"):2===i?n.addClass("mt-medal-silver"):3===i&&n.addClass("mt-medal-bronze"))}s.removeClass("position-gold position-silver position-bronze");for(let t=1;t<=n.length;t++)s.removeClass("rank-"+t);1===i?s.addClass("position-gold"):2===i?s.addClass("position-silver"):3===i&&s.addClass("position-bronze"),s.addClass("rank-"+i)});const s=n.length>0?t(n[0]).outerHeight():50,i={};n.forEach((e,a)=>{const n=t(e);i[n.data("candidate-id")]=a*s}),n.forEach(e=>{const a=t(e),n=a.data("candidate-id"),o=a.position().top,s=i[n];Math.abs(o-s)>5&&a.css({position:"relative",top:0,zIndex:100}).animate({top:s-o},400,function(){t(this).css({position:"",top:"",zIndex:""})})}),setTimeout(function(){t.each(n,function(t,e){a.append(e)})},450)}()},500)}),e.on("change",".mt-eval-score-input",function(){const e=t(this),a=parseFloat(e.val()),n=parseFloat(e.data("oldValue")||e.val());n!==a&&(function(e,a,n){const o=n-a,s=t('<span class="mt-score-change-indicator"></span>');if(o>0)s.text("+"+o.toFixed(1)).addClass("positive");else{if(!(o<0))return;s.text(o.toFixed(1)).addClass("negative")}const i=e.offset();s.css({position:"absolute",left:i.left+e.outerWidth()-20,top:i.top-10,zIndex:1e3}).appendTo("body"),s.animate({top:i.top-30,opacity:0},800,function(){t(this).remove()})}(e,n,a),e.data("oldValue",a))})})}(jQuery);