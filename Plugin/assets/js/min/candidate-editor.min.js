(a=>{var t={currentPostId:null,originalContent:{},hasUnsavedChanges:!1,activeEditors:{},init:function(){this.bindEvents()},bindEvents:function(){var e=this;a(document).on("click",".mt-inline-edit-btn",function(t){t.preventDefault();t=a(this).data("post-id");e.openEditModal(t)}),a(document).on("click",".mt-tab-btn",function(){var t=a(this).data("tab");e.switchTab(t)}),a(document).on("click",".mt-save-content",function(){e.saveContent()}),a(document).on("click",".mt-cancel-edit",function(){e.closeModal()}),a("#mt-inline-edit-modal").on("click",function(t){t.target===this&&e.closeModal()}),a(document).on("keydown",function(t){"Escape"===t.key&&a("#mt-inline-edit-modal").is(":visible")&&e.closeModal()})},openEditModal:function(t){var e=this;this.currentPostId=t,a("#mt-inline-edit-modal").show(),a(".mt-modal-body").html('<div style="text-align:center;padding:50px;">Loading...</div>'),a.ajax({url:ajaxurl,type:"POST",data:{action:"mt_get_candidate_content",post_id:t,nonce:a("#mt_candidate_editor_nonce").val()||mtCandidateEditor.nonce},success:function(t){t.success?e.populateModal(t.data):(alert(t.data.message||(mt_ajax&&mt_ajax.i18n&&mt_ajax.i18n.error_loading_content?mt_ajax.i18n.error_loading_content:"Error loading content")),e.closeModal())},error:function(){alert(mt_ajax&&mt_ajax.i18n&&mt_ajax.i18n.error_loading_content?mt_ajax.i18n.error_loading_content:"Error loading content"),e.closeModal()}})},populateModal:function(t){var e=this;e.originalContent={overview:t.overview||"",criteria:t.criteria||""},e.hasUnsavedChanges=!1;a(".mt-modal-body").html('<div class="mt-tab-content active" data-content="overview"><div class="mt-editor-container"><textarea id="mt-edit-overview" class="mt-rich-editor" rows="10" style="width:100%;"></textarea></div></div><div class="mt-tab-content" data-content="criteria" style="display:none;"><div style="margin-bottom:10px;"><button type="button" class="button mt-insert-template">Insert Criteria Template</button></div><div class="mt-editor-container"><textarea id="mt-edit-criteria" class="mt-rich-editor" rows="15" style="width:100%;"></textarea></div><div style="margin-top:10px;padding:10px;background:#f0f0f0;border-radius:3px;font-size:12px;"><strong>Format Tips:</strong><br>Use bold text for criteria headers (e.g., <strong>Mut & Pioniergeist:</strong>)<br>Add line breaks between sections for better readability</div></div>'),a("#mt-edit-overview").val(t.overview||""),a("#mt-edit-criteria").val(t.criteria||""),setTimeout(function(){e.initRichEditors()},100),a(".mt-insert-template").on("click",function(){e.insertCriteriaTemplate()}),this.switchTab("overview")},initRichEditors:function(){var e=this,t=(e.destroyEditors(),{tinymce:{wpautop:!0,plugins:"lists,link,wordpress,wplink,wptextpattern",toolbar1:"formatselect,bold,italic,bullist,numlist,blockquote,alignleft,aligncenter,alignright,link,unlink,wp_more,spellchecker,fullscreen,wp_adv",toolbar2:"strikethrough,hr,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help",height:300,setup:function(t){(e.activeEditors.overview=t).on("change keyup",function(){e.hasUnsavedChanges=!0})}},quicktags:!0,mediaButtons:!0}),i={tinymce:{wpautop:!0,plugins:"lists,link,wordpress,wplink,wptextpattern",toolbar1:"formatselect,bold,italic,bullist,numlist,blockquote,alignleft,aligncenter,alignright,link,unlink,wp_more,spellchecker,fullscreen,wp_adv",toolbar2:"strikethrough,hr,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help",height:400,setup:function(t){(e.activeEditors.criteria=t).on("change keyup",function(){e.hasUnsavedChanges=!0})}},quicktags:!0,mediaButtons:!1};"undefined"!=typeof wp&&wp.editor?(wp.editor.remove("mt-edit-overview"),wp.editor.remove("mt-edit-criteria"),wp.editor.initialize("mt-edit-overview",t),wp.editor.initialize("mt-edit-criteria",i)):"undefined"!=typeof tinymce?(tinymce.remove("#mt-edit-overview"),tinymce.remove("#mt-edit-criteria"),tinymce.init({selector:"#mt-edit-overview",height:300,menubar:!1,plugins:"lists link wordpress wplink",toolbar:"formatselect | bold italic | bullist numlist | link unlink | removeformat",content_css:!1,setup:function(t){(e.activeEditors.overview=t).on("change keyup",function(){e.hasUnsavedChanges=!0})}}),tinymce.init({selector:"#mt-edit-criteria",height:400,menubar:!1,plugins:"lists link wordpress wplink",toolbar:"formatselect | bold italic | bullist numlist | link unlink | removeformat",content_css:!1,setup:function(t){(e.activeEditors.criteria=t).on("change keyup",function(){e.hasUnsavedChanges=!0})}})):(a("#mt-edit-overview").on("input",function(){e.hasUnsavedChanges=!0}),a("#mt-edit-criteria").on("input",function(){e.hasUnsavedChanges=!0}))},destroyEditors:function(){"undefined"!=typeof wp&&wp.editor?(wp.editor.remove("mt-edit-overview"),wp.editor.remove("mt-edit-criteria")):"undefined"!=typeof tinymce&&(tinymce.remove("#mt-edit-overview"),tinymce.remove("#mt-edit-criteria")),this.activeEditors={}},insertCriteriaTemplate:function(){var t,e="<strong>Mut & Pioniergeist:</strong><br>\n[Content here]<br><br>\n<strong>Innovationsgrad:</strong><br>\n[Content here]<br><br>\n<strong>Umsetzungskraft & Wirkung:</strong><br>\n[Content here]<br><br>\n<strong>Relevanz für die Mobilitätswende:</strong><br>\n[Content here]<br><br>\n<strong>Vorbildfunktion & Sichtbarkeit:</strong><br>\n[Content here]";"undefined"!=typeof wp&&wp.editor?wp.editor.getContent("mt-edit-criteria")&&!confirm("This will replace the current content. Continue?")||(wp.editor.setContent(e,"mt-edit-criteria"),this.hasUnsavedChanges=!0):this.activeEditors.criteria?this.activeEditors.criteria.getContent()&&!confirm("This will replace the current content. Continue?")||(this.activeEditors.criteria.setContent(e),this.hasUnsavedChanges=!0):(t=a("#mt-edit-criteria")).val()&&!confirm("This will replace the current content. Continue?")||t.val(e).trigger("input")},switchTab:function(t){a(".mt-tab-btn").removeClass("active"),a('.mt-tab-btn[data-tab="'+t+'"]').addClass("active"),a(".mt-tab-content").hide(),a('.mt-tab-content[data-content="'+t+'"]').show(),this.activeEditors[t]&&this.activeEditors[t].focus()},getEditorContent:function(t){if("undefined"!=typeof wp&&wp.editor)return wp.editor.getContent(t);if("undefined"!=typeof tinymce){var e=tinymce.get(t);if(e)return e.getContent()}return a("#"+t).val()},saveContent:function(){var e=this,i=a(".mt-save-content"),n=(i.prop("disabled",!0).text("Saving..."),a(".mt-tab-btn.active").data("tab")),o="";"overview"===n?o=e.getEditorContent("mt-edit-overview"):"criteria"===n&&(o=e.getEditorContent("mt-edit-criteria")),a.ajax({url:ajaxurl,type:"POST",data:{action:"mt_update_candidate_content",post_id:e.currentPostId,field:n,content:o,nonce:a("#mt_candidate_editor_nonce").val()||mtCandidateEditor.nonce},success:function(t){t.success?(e.originalContent[n]=o,e.hasUnsavedChanges=!1,i.text("Saved!"),"overview"===n&&a("#mt_overview").length?(a("#mt_overview").val(o),"undefined"!=typeof wp&&wp.editor?wp.editor.setContent(o,"mt_overview"):"undefined"!=typeof tinymce&&tinymce.get("mt_overview")&&tinymce.get("mt_overview").setContent(o)):"criteria"===n&&a("#mt_evaluation_criteria").length&&(a("#mt_evaluation_criteria").val(o),"undefined"!=typeof wp&&wp.editor?wp.editor.setContent(o,"mt_evaluation_criteria"):"undefined"!=typeof tinymce&&tinymce.get("mt_evaluation_criteria")&&tinymce.get("mt_evaluation_criteria").setContent(o)),setTimeout(function(){i.prop("disabled",!1).text("Save Changes")},2e3)):(alert(t.data.message||(mt_ajax&&mt_ajax.i18n&&mt_ajax.i18n.error_saving_content?mt_ajax.i18n.error_saving_content:"Error saving content")),i.prop("disabled",!1).text("Save Changes"))},error:function(){alert(mt_ajax&&mt_ajax.i18n&&mt_ajax.i18n.error_saving_content?mt_ajax.i18n.error_saving_content:"Error saving content"),i.prop("disabled",!1).text("Save Changes")}})},closeModal:function(){this.hasUnsavedChanges&&!confirm(mt_ajax&&mt_ajax.i18n&&mt_ajax.i18n.unsaved_changes_warning?mt_ajax.i18n.unsaved_changes_warning:"You have unsaved changes. Are you sure you want to close?")||(this.destroyEditors(),a("#mt-inline-edit-modal").hide(),this.currentPostId=null,this.hasUnsavedChanges=!1)}};a(document).ready(function(){a("#mt-inline-edit-modal").length&&t.init()}),window.MTCandidateEditor=t})(jQuery);