jQuery(document).ready(function(d){d(document).on("click","#mt-import-candidates",function(e){var s;e.preventDefault(),"undefined"==typeof mt_ajax?alert("Import functionality is not properly initialized. Please refresh the page and try again."):(s=d("<input>",{type:"file",accept:".csv,text/csv,application/csv",style:"display: none"}),d("body").append(s),s.on("change",function(e){var a,t,i,n,r=this.files[0];r?(a=r.name.toLowerCase()).endsWith(".csv")?10485760<r.size?(alert(mt_ajax.i18n.file_too_large||"File is too large. Maximum size is 10MB."),s.remove()):((t=new FormData).append("action","mt_import_candidates"),t.append("csv_file",r),t.append("nonce",mt_ajax.nonce),d("#update_existing").length&&t.append("update_existing",d("#update_existing").is(":checked")?"1":"0"),d("#skip_duplicates").length&&t.append("skip_duplicates",d("#skip_duplicates").is(":checked")?"1":"0"),i=d("#mt-import-candidates"),n=i.text(),i.prop("disabled",!0).text(mt_ajax.i18n.importing||"Importing..."),d(".mt-import-overlay").length?d(".mt-import-overlay").show():(r=d("<div>",{class:"mt-import-overlay",style:"position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;"}).html('<div style="background: white; padding: 20px; border-radius: 5px;"><p>'+(mt_ajax.i18n.importing||"Importing...")+'</p><div class="spinner is-active" style="float: none;"></div></div>'),d("body").append(r)),d.ajax({url:mt_ajax.ajax_url||ajaxurl,type:"POST",data:t,processData:!1,contentType:!1,success:function(e){var a,t;d(".mt-import-overlay").remove(),i.prop("disabled",!1).text(n),e.success?(a=mt_ajax.i18n.import_complete||"Import complete!",e.data&&(t=[],0<e.data.imported&&t.push(e.data.imported+" "+(mt_ajax.i18n.created||"created")),0<e.data.updated&&t.push(e.data.updated+" "+(mt_ajax.i18n.updated||"updated")),0<e.data.skipped&&t.push(e.data.skipped+" "+(mt_ajax.i18n.skipped||"skipped")),0<e.data.errors&&t.push(e.data.errors+" "+(mt_ajax.i18n.errors||"errors")),0<t.length&&(a+="\n\n"+t.join(", ")),e.data.error_details)&&0<e.data.error_details.length&&(a+="\n\n"+(mt_ajax.i18n.error_details||"Error details:"),e.data.error_details.slice(0,5).forEach(function(e){a+="\n- Row "+e.row+" ("+e.name+"): "+e.error}),5<e.data.error_details.length)&&(a+="\n... and "+(e.data.error_details.length-5)+" more errors"),alert(a),window.location.reload()):(d(".mt-import-overlay").remove(),i.prop("disabled",!1).text(n),t=mt_ajax.i18n.import_failed||"Import failed!",e.data&&e.data.message&&(t+="\n\n"+e.data.message),alert(t)),s.remove()},error:function(e,a,t){d(".mt-import-overlay").remove(),i.prop("disabled",!1).text(n);var r=mt_ajax.i18n.import_error||"An error occurred during import.";if(e.responseJSON&&e.responseJSON.data&&e.responseJSON.data.message)r+="\n\n"+e.responseJSON.data.message;else if(e.responseText)try{var o=JSON.parse(e.responseText);o.data&&o.data.message&&(r+="\n\n"+o.data.message)}catch(e){r+="\n\nStatus: "+a+"\nError: "+t}else r+="\n\nStatus: "+a+"\nError: "+t;alert(r),s.remove()}})):("xlsx"===(r=a.split(".").pop())||"xls"===r?alert('Please convert your Excel file to CSV format first. Use "Save As" in Excel and choose "CSV (Comma delimited)" as the file type.'):alert(mt_ajax.i18n.invalid_file_type||"Please select a CSV file."),s.remove()):s.remove()}),s.trigger("click"))});var e=d("#mt-import-drop-zone");e.length&&(e.on("dragenter dragover",function(e){e.preventDefault(),e.stopPropagation(),d(this).addClass("drag-over")}),e.on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),d(this).removeClass("drag-over")}),e.on("drop",function(e){e.preventDefault(),e.stopPropagation(),d(this).removeClass("drag-over");var e=e.originalEvent.dataTransfer.files;0<e.length&&((e=e[0].name.toLowerCase()).endsWith(".csv")||("xlsx"===(e=e.split(".").pop())||"xls"===e?alert('Please convert your Excel file to CSV format first. Use "Save As" in Excel and choose "CSV (Comma delimited)" as the file type.'):alert(mt_ajax.i18n.invalid_file_type||"Please select a CSV file.")))})),d(document).on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),d(document).on("drop",function(e){e.preventDefault(),e.stopPropagation()})});