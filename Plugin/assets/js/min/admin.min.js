("ontouchstart"in window||navigator.maxTouchPoints>0)&&jQuery(document).ready(function(t){window.MTEventManager?MTEventManager.on("touchstart",".mt-evaluation-slider, .mt-score-slider, .ui-slider-handle",function(e){var n=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t(this).trigger("mousedown",n)},"admin_touch"):t(document).on("touchstart.mt_admin",".mt-evaluation-slider, .mt-score-slider, .ui-slider-handle",function(e){var n=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t(this).trigger("mousedown",n)}),t(".mt-evaluation-slider, .mt-score-slider").css({"min-height":"44px","touch-action":"pan-y"}),t("body").addClass("mt-touch-enabled")}),"undefined"==typeof mt_admin&&(window.mt_admin={ajax_url:ajaxurl||"/wp-admin/admin-ajax.php",nonce:$("#mt_admin_nonce").val()||"",admin_url:"/wp-admin/",i18n:{confirm_remove_assignment:"Are you sure you want to remove this assignment?",assignment_removed:"Assignment removed successfully.",error_occurred:"An error occurred. Please try again.",no_assignments:"No assignments yet",processing:"Processing...",select_jury_and_candidates:"Please select a jury member and at least one candidate.",assignments_created:"Assignments created successfully.",assign_selected:"Assign Selected",confirm_clear_all:"Are you sure you want to clear ALL assignments? This cannot be undone.",confirm_clear_all_second:"This will remove ALL jury assignments. Are you absolutely sure?",clearing:"Clearing...",clear_all:"Clear All",all_assignments_cleared:"All assignments have been cleared.",export_started:"Export started. Download will begin shortly."}}),void 0===mt_admin.i18n&&(mt_admin.i18n={confirm_remove_assignment:"Are you sure you want to remove this assignment?",assignment_removed:"Assignment removed successfully.",error_occurred:"An error occurred. Please try again.",no_assignments:"No assignments yet",processing:"Processing...",select_jury_and_candidates:"Please select a jury member and at least one candidate.",assignments_created:"Assignments created successfully.",assign_selected:"Assign Selected",confirm_clear_all:"Are you sure you want to clear ALL assignments? This cannot be undone.",confirm_clear_all_second:"This will remove ALL jury assignments. Are you absolutely sure?",clearing:"Clearing...",clear_all:"Clear All",all_assignments_cleared:"All assignments have been cleared.",export_started:"Export started. Download will begin shortly."}),function(t){"use strict";function e(){"function"==typeof t.fn.tooltip&&t(".mt-tooltip").tooltip()}window.mtShowNotification=function(e,n){n=n||"info",t(".mt-notification").remove();const a=`\n            <div class="mt-notification notice ${{success:"notice-success",error:"notice-error",warning:"notice-warning",info:"notice-info"}[n]||"notice-info"} is-dismissible">\n                <p>${e}</p>\n                <button type="button" class="notice-dismiss">\n                    <span class="screen-reader-text">Dismiss this notice.</span>\n                </button>\n            </div>\n        `,i=t(".wrap h1").first();i.length?t(a).insertAfter(i):t(".wrap").prepend(a),"success"===n&&setTimeout(function(){t(".mt-notification").fadeOut(400,function(){t(this).remove()})},5e3),t(document).on("click.mt_admin",".mt-notification .notice-dismiss",function(){t(this).closest(".mt-notification").fadeOut(400,function(){t(this).remove()})})},window.setButtonLoading=function(t,e,n){if(e)t.addClass("loading").prop("disabled",!0),n&&t.data("original-text",n);else{t.removeClass("loading").prop("disabled",!1);const e=t.data("original-text");e&&t.text(e)}},window.setLoadingOverlay=function(t,e){e?t.addClass("mt-loading-overlay active"):t.removeClass("active")},window.refreshDashboardWidget=function(n,a){const i=t("#"+n);i.length?(i.addClass("mt-widget-loading"),t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_refresh_widget",widget:n,nonce:mt_admin.nonce},success:function(t){t.success&&t.data&&t.data.html?(i.html(t.data.html),e(),a&&a(!0)):a&&a(!1)},error:function(){a&&a(!1)},complete:function(){i.removeClass("mt-widget-loading")}})):a&&a(!1)},window.refreshDashboardWidgets=function(t){Array.isArray(t)||(t=[t]),t.forEach(function(t){refreshDashboardWidget(t)})};const n={init:function(){this.bindEvents(),this.initBulkActions()},bindEvents:function(){t(document).on("click","#mt-auto-assign-btn",t=>{t.preventDefault(),this.showAutoAssignModal()}),t(document).on("click","#mt-manual-assign-btn",t=>{t.preventDefault(),this.showManualAssignModal()}),t(document).on("click","#mt-bulk-actions-btn",t=>{t.preventDefault(),this.toggleBulkActions()}),t(document).on("click","#mt-export-btn",t=>{t.preventDefault(),this.exportAssignments()}),t(document).on("click","#mt-clear-all-btn",t=>{t.preventDefault(),this.clearAllAssignments()}),t(document).on("click",".mt-remove-assignment",e=>{e.preventDefault(),this.removeAssignment(t(e.currentTarget))}),t(document).on("click",".mt-modal-close",e=>{e.preventDefault(),t(".mt-modal").fadeOut(300)}),t(document).on("submit","#mt-manual-assignment-form",t=>{t.preventDefault(),this.submitManualAssignment()}),t(document).on("submit","#mt-auto-assign-modal form",t=>{t.preventDefault(),this.submitAutoAssignment()}),t(document).on("change","#mt-filter-jury, #mt-filter-status",()=>{this.applyFilters()}),t(document).on("keyup","#mt-assignment-search",function(){const e=t(this).val();n.filterAssignments(e)})},initBulkActions:function(){t(document).on("change","#mt-select-all-assignments",function(){t(".mt-assignment-checkbox").prop("checked",t(this).prop("checked"))}),t(document).on("click","#mt-apply-bulk-action",t=>{t.preventDefault(),this.applyBulkAction()}),t(document).on("click","#mt-cancel-bulk-action",t=>{t.preventDefault(),this.toggleBulkActions()})},showAutoAssignModal:function(){t("#mt-auto-assign-modal").fadeIn(300)},showManualAssignModal:function(){t("#mt-manual-assign-modal").fadeIn(300)},submitAutoAssignment:function(){const e=t("#assignment_method").val(),n=t("#candidates_per_jury").val(),a=t("#clear_existing").is(":checked")?"true":"false";t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_auto_assign",nonce:mt_admin.nonce,method:e,candidates_per_jury:n,clear_existing:a},beforeSend:()=>{t('#mt-auto-assign-modal button[type="submit"]').prop("disabled",!0).text(mt_admin.i18n.processing||"Processing...")},success:e=>{e.success?(mtShowNotification(e.data.message||mt_admin.i18n.assignments_created,"success"),t("#mt-auto-assign-modal").fadeOut(300),setTimeout(()=>{location.reload()},1500)):mtShowNotification(e.data||mt_admin.i18n.error_occurred,"error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred,"error")},complete:()=>{t('#mt-auto-assign-modal button[type="submit"]').prop("disabled",!1).text("Run Auto-Assignment")}})},submitManualAssignment:function(){const e=t("#manual_jury_member").val(),n=[];t('input[name="candidate_ids[]"]:checked').each(function(){n.push(t(this).val())}),e&&0!==n.length?t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_manual_assign",nonce:mt_admin.nonce,jury_member_id:e,candidate_ids:n},beforeSend:()=>{t('#mt-manual-assignment-form button[type="submit"]').prop("disabled",!0).text(mt_admin.i18n.processing||"Processing...")},success:e=>{e.success?(mtShowNotification(e.data.message||mt_admin.i18n.assignments_created,"success"),t("#mt-manual-assign-modal").fadeOut(300),setTimeout(()=>{location.reload()},1500)):mtShowNotification(e.data||mt_admin.i18n.error_occurred,"error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred,"error")},complete:()=>{t('#mt-manual-assignment-form button[type="submit"]').prop("disabled",!1).text(mt_admin.i18n.assign_selected)}}):mtShowNotification(mt_admin.i18n.select_jury_and_candidates,"warning")},removeAssignment:function(e){const n=e.data("assignment-id");e.data("jury"),e.data("candidate");confirm(mt_admin.i18n.confirm_remove_assignment)&&t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_remove_assignment",nonce:mt_admin.nonce,assignment_id:n},beforeSend:()=>{e.prop("disabled",!0).text(mt_admin.i18n.processing||"Processing...")},success:n=>{n.success?(e.closest("tr").fadeOut(400,function(){t(this).remove(),0===t(".mt-assignments-table tbody tr").length&&t(".mt-assignments-table tbody").html('<tr><td colspan="8" class="no-items">'+mt_admin.i18n.no_assignments+"</td></tr>")}),mtShowNotification(mt_admin.i18n.assignment_removed,"success")):mtShowNotification(n.data||mt_admin.i18n.error_occurred,"error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred,"error")},complete:()=>{e.prop("disabled",!1).text(mt_admin&&mt_admin.i18n&&mt_admin.i18n.remove?mt_admin.i18n.remove:"Entfernen")}})},clearAllAssignments:function(){confirm(mt_admin.i18n.confirm_clear_all)&&confirm(mt_admin.i18n.confirm_clear_all_second)&&t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_clear_all_assignments",nonce:mt_admin.nonce},beforeSend:()=>{t("#mt-clear-all-btn").prop("disabled",!0).text(mt_admin.i18n.clearing||"Clearing...")},success:t=>{t.success?(mtShowNotification(mt_admin.i18n.all_assignments_cleared,"success"),location.reload()):mtShowNotification(t.data||mt_admin.i18n.error_occurred,"error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred,"error")},complete:()=>{t("#mt-clear-all-btn").prop("disabled",!1).html('<span class="dashicons dashicons-trash"></span> '+mt_admin.i18n.clear_all)}})},exportAssignments:function(){const e=t("<form/>",{action:mt_admin.ajax_url,method:"POST"});e.append(t("<input/>",{type:"hidden",name:"action",value:"mt_export_assignments"})),e.append(t("<input/>",{type:"hidden",name:"nonce",value:mt_admin.nonce})),e.appendTo("body").submit().remove(),mtShowNotification(mt_admin.i18n.export_started,"info")},toggleBulkActions:function(){const e=t("#mt-bulk-actions-container"),n=t(".check-column");e.is(":visible")?(e.slideUp(),n.hide(),t(".mt-assignment-checkbox").prop("checked",!1),t("#mt-select-all-assignments").prop("checked",!1)):(e.slideDown(),n.show())},applyBulkAction:function(){const e=t("#mt-bulk-action-select").val(),n=[];t(".mt-assignment-checkbox:checked").each(function(){n.push(t(this).val())}),e?0!==n.length?"remove"===e?this.bulkRemoveAssignments(n):"export"===e?this.bulkExportAssignments(n):"reassign"===e&&this.showReassignModal(n):mtShowNotification(mt_admin.i18n.select_assignments||"Please select at least one assignment","warning"):mtShowNotification(mt_admin.i18n.select_bulk_action||"Please select a bulk action","warning")},bulkRemoveAssignments:function(e){confirm("Are you sure you want to remove the selected assignments?")&&t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_bulk_remove_assignments",nonce:mt_admin.nonce,assignment_ids:e},beforeSend:()=>{t("#mt-apply-bulk-action").prop("disabled",!0).text("Processing...")},success:t=>{t.success?(mtShowNotification(t.data.message||"Assignments removed successfully","success"),location.reload()):mtShowNotification(t.data||"An error occurred","error")},error:()=>{mtShowNotification("An error occurred","error")},complete:()=>{t("#mt-apply-bulk-action").prop("disabled",!1).text("Apply")}})},bulkExportAssignments:function(e){const n=t("<form/>",{action:mt_admin.ajax_url,method:"POST"});n.append(t("<input/>",{type:"hidden",name:"action",value:"mt_export_assignments"})),n.append(t("<input/>",{type:"hidden",name:"nonce",value:mt_admin.nonce})),e.forEach(e=>{n.append(t("<input/>",{type:"hidden",name:"assignment_ids[]",value:e}))}),n.appendTo("body").submit().remove()},filterAssignments:function(e){const n=t(".mt-assignments-table tbody tr");if(!e)return void n.show();const a=e.toLowerCase();n.each(function(){t(this).text().toLowerCase().includes(a)?t(this).show():t(this).hide()})},applyFilters:function(){const e=t("#mt-filter-jury").val(),n=t("#mt-filter-status").val();t(".mt-assignments-table tbody tr").each(function(){let a=!0;const i=t(this);if(e){i.find(".mt-assignment-checkbox").data("jury-id")!=e&&(a=!1)}if(n&&a){i.find(".mt-status").text().toLowerCase()!==n&&(a=!1)}a?i.show():i.hide()})},showReassignModal:function(e){this.pendingReassignments=e,0===t("#mt-reassign-modal").length&&this.createReassignModal(),t("#mt-reassign-modal").fadeIn(300)},createReassignModal:function(){const e=t("#mt-filter-jury option").clone(),n=`\n                <div id="mt-reassign-modal" class="mt-modal" style="display: none;">\n                    <div class="mt-modal-content">\n                        <h2>${mt_admin.i18n.reassign_assignments||"Reassign Assignments"}</h2>\n                        <p>${mt_admin.i18n.reassign_description||"Select a new jury member to reassign the selected assignments to:"}</p>\n                        <form id="mt-reassign-form">\n                            <div class="mt-form-group">\n                                <label for="reassign_jury_member">${mt_admin.i18n.new_jury_member||"New Jury Member"}</label>\n                                <select name="new_jury_member_id" id="reassign_jury_member" class="widefat" required>\n                                    <option value="">${mt_admin.i18n.select_jury_member||"Select Jury Member"}</option>\n                                </select>\n                            </div>\n                            <div class="mt-modal-actions">\n                                <button type="submit" class="button button-primary">${mt_admin.i18n.reassign||"Reassign"}</button>\n                                <button type="button" class="button mt-modal-close">${mt_admin.i18n.cancel||"Cancel"}</button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            `;t("body").append(n),t("#reassign_jury_member").html(e),t(document).on("click","#mt-reassign-modal .mt-modal-close",e=>{e.preventDefault(),t("#mt-reassign-modal").fadeOut(300)}),t(document).on("submit","#mt-reassign-form",t=>{t.preventDefault(),this.submitReassignment()})},submitReassignment:function(){const e=t("#reassign_jury_member").val();e?this.pendingReassignments&&0!==this.pendingReassignments.length?t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_bulk_reassign_assignments",nonce:mt_admin.nonce,assignment_ids:this.pendingReassignments,new_jury_member_id:e},beforeSend:()=>{t('#mt-reassign-form button[type="submit"]').prop("disabled",!0).text(mt_admin.i18n.processing||"Processing...")},success:e=>{e.success?(mtShowNotification(e.data.message||"Assignments reassigned successfully","success"),t("#mt-reassign-modal").fadeOut(300),location.reload()):mtShowNotification(e.data||"An error occurred","error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred||"An error occurred","error")},complete:()=>{t('#mt-reassign-form button[type="submit"]').prop("disabled",!1).text(mt_admin.i18n.reassign||"Reassign")}}):mtShowNotification(mt_admin.i18n.no_assignments_selected||"No assignments selected","warning"):mtShowNotification(mt_admin.i18n.select_jury_member||"Please select a jury member","warning")}};window.MTEvaluationManager={init:function(){this.bindEvents()},getConfirmMessage:function(t){return{delete:mt_admin.i18n.confirm_delete_evaluations||"Are you sure you want to permanently delete the selected evaluations? This cannot be undone.",approve:mt_admin.i18n.confirm_approve_evaluations||"Are you sure you want to approve the selected evaluations?",reject:mt_admin.i18n.confirm_reject_evaluations||"Are you sure you want to reject the selected evaluations?",reset:mt_admin.i18n.confirm_reset_evaluations||"Are you sure you want to reset the selected evaluations to draft status?",export:mt_admin.i18n.confirm_export_evaluations||"Are you sure you want to export the selected evaluations?"}[t]||"Are you sure you want to "+t+" the selected evaluations?"},bindEvents:function(){t(document).on("click",".view-details",e=>{const n=t(e.currentTarget),a=n.data("evaluation-id");this.viewDetails(a,n)}),t(document).on("click","#cb-select-all-1, #cb-select-all-2",this.handleSelectAll),t('input[name="evaluation[]"]').on("click",this.handleSingleSelect),t(document).on("click","#doaction, #doaction2",e=>{const n=t(e.currentTarget).prev("select").val();this.applyBulkAction(n)})},viewDetails:function(e,n){const a=this.createModal();a.data("trigger",n),a.find(".mt-modal-body").html('<div class="mt-loading">Loading evaluation details...</div>'),a.fadeIn(300,function(){a.find(".mt-modal-body").focus()}),t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_get_evaluation_details",nonce:mt_admin.nonce,evaluation_id:e},success:t=>{if(t.success){const e=this.renderEvaluationDetails(t.data);a.find(".mt-modal-body").html(e)}else a.find(".mt-modal-body").html('<div class="notice notice-error"><p>'+(t.data?.message||"Failed to load evaluation details")+"</p></div>")},error:()=>{a.find(".mt-modal-body").html('<div class="notice notice-error"><p>An error occurred while loading evaluation details</p></div>')}})},createModal:function(){let e=t("#mt-evaluation-modal");if(0===e.length){const n='\n                    <div id="mt-evaluation-modal" class="mt-modal" role="dialog" aria-modal="true" aria-labelledby="mt-modal-title" style="display:none;">\n                        <div class="mt-modal-overlay" aria-hidden="true"></div>\n                        <div class="mt-modal-content">\n                            <div class="mt-modal-header">\n                                <h2 id="mt-modal-title">Evaluation Details</h2>\n                                <button class="mt-modal-close" aria-label="Close dialog" type="button">&times;</button>\n                            </div>\n                            <div class="mt-modal-body" tabindex="0"></div>\n                        </div>\n                    </div>\n                ';t("body").append(n),e=t("#mt-evaluation-modal"),e.find(".mt-modal-close, .mt-modal-overlay").on("click",()=>{this.closeModal(e)}),t(document).on("keydown",t=>{"Escape"===t.key&&e.is(":visible")&&this.closeModal(e)})}return e},closeModal:function(t){t.fadeOut(300,function(){t.data("trigger")&&t.data("trigger").focus()})},renderEvaluationDetails:function(t){let e="";for(const[n,a]of Object.entries(t.scores))e+=`\n                    <div class="mt-score-item">\n                        <label>${a.label}:</label>\n                        <span class="mt-score-value">${a.value}/10</span>\n                        <div class="mt-score-bar">\n                            <div class="mt-score-fill" style="width: ${10*a.value}%"></div>\n                        </div>\n                    </div>\n                `;return`\n                <div class="mt-evaluation-details">\n                    <div class="mt-detail-section">\n                        <h3>Basic Information</h3>\n                        <table class="mt-detail-table">\n                            <tr>\n                                <th>Jury Member:</th>\n                                <td>${t.jury_member}</td>\n                            </tr>\n                            <tr>\n                                <th>Candidate:</th>\n                                <td>${t.candidate}</td>\n                            </tr>\n                            <tr>\n                                <th>Organization:</th>\n                                <td>${t.organization||"-"}</td>\n                            </tr>\n                            <tr>\n                                <th>Categories:</th>\n                                <td>${t.categories||"-"}</td>\n                            </tr>\n                            <tr>\n                                <th>Status:</th>\n                                <td><span class="mt-status mt-status-${t.status}">${t.status}</span></td>\n                            </tr>\n                        </table>\n                    </div>\n                    <div class="mt-detail-section">\n                        <h3>Scores</h3>\n                        ${e}\n                        <div class="mt-score-summary">\n                            <strong>${mt_evaluations_i18n.total_score_label||"Total Score:"}</strong> ${t.total_score.toFixed(1)}/50\n                            <br>\n                            <strong>${mt_evaluations_i18n.average_score_label||"Average Score:"}</strong> ${t.average_score.toFixed(1)}/10\n                        </div>\n                    </div>\n                    ${t.comments?`\n                        <div class="mt-detail-section">\n                            <h3>Comments</h3>\n                            <div class="mt-comments">${t.comments}</div>\n                        </div>\n                    `:""}\n                    <div class="mt-detail-section mt-timestamps">\n                        <small>\n                            Created: ${t.created_at}<br>\n                            Last Updated: ${t.updated_at}\n                        </small>\n                    </div>\n                </div>\n            `},handleSelectAll:function(){const e=t(this).prop("checked");t('input[name="evaluation[]"]').prop("checked",e),t("#cb-select-all-1, #cb-select-all-2").prop("checked",e)},handleSingleSelect:function(){const e=t('input[name="evaluation[]"]').length===t('input[name="evaluation[]"]:checked').length;t("#cb-select-all-1, #cb-select-all-2").prop("checked",e)},applyBulkAction:function(e){if("-1"===e)return void mtShowNotification(mt_admin.i18n.select_bulk_action||"Please select a bulk action","warning");const n=[];if(t('input[name="evaluation[]"]:checked').each(function(){n.push(t(this).val())}),0===n.length)return void mtShowNotification(mt_admin.i18n.select_assignments||"Please select at least one evaluation","warning");const a=this.getConfirmMessage(e);confirm(a)&&this.performBulkAction(e,n)},performBulkAction:function(e,n){const a=t("#doaction, #doaction2"),i=a.first().val(),s=t(".spinner");s.length&&s.addClass("is-active"),t.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_bulk_evaluation_action",bulk_action:e,evaluation_ids:n,nonce:mt_admin.nonce},beforeSend:function(){a.prop("disabled",!0).val(mt_admin.i18n.processing||"Processing..."),t('input[name="evaluation[]"]:checked').closest("tr").addClass("processing").css("opacity","0.6")},success:function(e){e.success?(mtShowNotification(e.data.message||"Bulk action completed successfully","success"),setTimeout(function(){location.reload()},1e3)):(mtShowNotification(e.data||"An error occurred","error"),t('input[name="evaluation[]"]:checked').closest("tr").removeClass("processing").css("opacity","1"))},error:function(e,n,a){const i=mt_admin.i18n.error_occurred||"An error occurred. Please try again.";mtShowNotification(i+" ("+a+")","error"),t('input[name="evaluation[]"]:checked').closest("tr").removeClass("processing").css("opacity","1")},complete:function(){a.prop("disabled",!1).val(i||"Apply"),s.length&&s.removeClass("is-active")}})}},t(document).ready(function(){e(),t.fn.select2&&t(".mt-select2").select2(),t.fn.datepicker&&t(".mt-datepicker").datepicker({dateFormat:"yy-mm-dd"}),(t("#mt-auto-assign-btn").length>0||t(".mt-assignments-table").length>0)&&n.init(),t("body").hasClass("mobility-trailblazers_page_mt-evaluations")&&window.MTEvaluationManager.init()})}(jQuery);
//# sourceMappingURL=admin.js.map