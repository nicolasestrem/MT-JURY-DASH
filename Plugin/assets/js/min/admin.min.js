("ontouchstart"in window||0<navigator.maxTouchPoints)&&jQuery(document).ready(function(t){window.MTEventManager?MTEventManager.on("touchstart",".mt-evaluation-slider, .mt-score-slider, .ui-slider-handle",function(e){e=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t(this).trigger("mousedown",e)},"admin_touch"):t(document).on("touchstart.mt_admin",".mt-evaluation-slider, .mt-score-slider, .ui-slider-handle",function(e){e=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t(this).trigger("mousedown",e)}),t(".mt-evaluation-slider, .mt-score-slider").css({"min-height":"44px","touch-action":"pan-y"}),t("body").addClass("mt-touch-enabled")}),"undefined"==typeof mt_admin&&(window.mt_admin={ajax_url:ajaxurl||"/wp-admin/admin-ajax.php",nonce:$("#mt_admin_nonce").val()||"",admin_url:"/wp-admin/",i18n:{confirm_remove_assignment:"Are you sure you want to remove this assignment?",assignment_removed:"Assignment removed successfully.",error_occurred:"An error occurred. Please try again.",no_assignments:"No assignments yet",processing:"Processing...",select_jury_and_candidates:"Please select a jury member and at least one candidate.",assignments_created:"Assignments created successfully.",assign_selected:"Assign Selected",confirm_clear_all:"Are you sure you want to clear ALL assignments? This cannot be undone.",confirm_clear_all_second:"This will remove ALL jury assignments. Are you absolutely sure?",clearing:"Clearing...",clear_all:"Clear All",all_assignments_cleared:"All assignments have been cleared.",export_started:"Export started. Download will begin shortly."}}),void 0===mt_admin.i18n&&(mt_admin.i18n={confirm_remove_assignment:"Are you sure you want to remove this assignment?",assignment_removed:"Assignment removed successfully.",error_occurred:"An error occurred. Please try again.",no_assignments:"No assignments yet",processing:"Processing...",select_jury_and_candidates:"Please select a jury member and at least one candidate.",assignments_created:"Assignments created successfully.",assign_selected:"Assign Selected",confirm_clear_all:"Are you sure you want to clear ALL assignments? This cannot be undone.",confirm_clear_all_second:"This will remove ALL jury assignments. Are you absolutely sure?",clearing:"Clearing...",clear_all:"Clear All",all_assignments_cleared:"All assignments have been cleared.",export_started:"Export started. Download will begin shortly."}),(s=>{function a(){"function"==typeof s.fn.tooltip&&s(".mt-tooltip").tooltip()}window.mtShowNotification=function(e,t){t=t||"info",s(".mt-notification").remove();var e=`
            <div class="mt-notification notice ${{success:"notice-success",error:"notice-error",warning:"notice-warning",info:"notice-info"}[t]||"notice-info"} is-dismissible">
                <p>${e}</p>
                <button type="button" class="notice-dismiss">
                    <span class="screen-reader-text">Dismiss this notice.</span>
                </button>
            </div>
        `,n=s(".wrap h1").first();n.length?s(e).insertAfter(n):s(".wrap").prepend(e),"success"===t&&setTimeout(function(){s(".mt-notification").fadeOut(400,function(){s(this).remove()})},5e3),s(document).on("click.mt_admin",".mt-notification .notice-dismiss",function(){s(this).closest(".mt-notification").fadeOut(400,function(){s(this).remove()})})},window.setButtonLoading=function(e,t,n){t?(e.addClass("loading").prop("disabled",!0),n&&e.data("original-text",n)):(e.removeClass("loading").prop("disabled",!1),(t=e.data("original-text"))&&e.text(t))},window.setLoadingOverlay=function(e,t){t?e.addClass("mt-loading-overlay active"):e.removeClass("active")},window.refreshDashboardWidget=function(e,t){let n=s("#"+e);n.length?(n.addClass("mt-widget-loading"),s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_refresh_widget",widget:e,nonce:mt_admin.nonce},success:function(e){e.success&&e.data&&e.data.html?(n.html(e.data.html),a(),t&&t(!0)):t&&t(!1)},error:function(){t&&t(!1)},complete:function(){n.removeClass("mt-widget-loading")}})):t&&t(!1)},window.refreshDashboardWidgets=function(e){(e=Array.isArray(e)?e:[e]).forEach(function(e){refreshDashboardWidget(e)})};let t={init:function(){this.bindEvents(),this.initBulkActions()},bindEvents:function(){s(document).on("click","#mt-auto-assign-btn",e=>{e.preventDefault(),this.showAutoAssignModal()}),s(document).on("click","#mt-manual-assign-btn",e=>{e.preventDefault(),this.showManualAssignModal()}),s(document).on("click","#mt-bulk-actions-btn",e=>{e.preventDefault(),this.toggleBulkActions()}),s(document).on("click","#mt-export-btn",e=>{e.preventDefault(),this.exportAssignments()}),s(document).on("click","#mt-clear-all-btn",e=>{e.preventDefault(),this.clearAllAssignments()}),s(document).on("click",".mt-remove-assignment",e=>{e.preventDefault(),this.removeAssignment(s(e.currentTarget))}),s(document).on("click",".mt-modal-close",e=>{e.preventDefault(),s(".mt-modal").fadeOut(300)}),s(document).on("submit","#mt-manual-assignment-form",e=>{e.preventDefault(),this.submitManualAssignment()}),s(document).on("submit","#mt-auto-assign-modal form",e=>{e.preventDefault(),this.submitAutoAssignment()}),s(document).on("change","#mt-filter-jury, #mt-filter-status",()=>{this.applyFilters()}),s(document).on("keyup","#mt-assignment-search",function(){var e=s(this).val();t.filterAssignments(e)})},initBulkActions:function(){s(document).on("change","#mt-select-all-assignments",function(){s(".mt-assignment-checkbox").prop("checked",s(this).prop("checked"))}),s(document).on("click","#mt-apply-bulk-action",e=>{e.preventDefault(),this.applyBulkAction()}),s(document).on("click","#mt-cancel-bulk-action",e=>{e.preventDefault(),this.toggleBulkActions()})},showAutoAssignModal:function(){s("#mt-auto-assign-modal").fadeIn(300)},showManualAssignModal:function(){s("#mt-manual-assign-modal").fadeIn(300)},submitAutoAssignment:function(){var e=s("#assignment_method").val(),t=s("#candidates_per_jury").val(),n=s("#clear_existing").is(":checked")?"true":"false";s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_auto_assign",nonce:mt_admin.nonce,method:e,candidates_per_jury:t,clear_existing:n},beforeSend:()=>{s('#mt-auto-assign-modal button[type="submit"]').prop("disabled",!0).text(mt_admin.i18n.processing||"Processing...")},success:e=>{e.success?(mtShowNotification(e.data.message||mt_admin.i18n.assignments_created,"success"),s("#mt-auto-assign-modal").fadeOut(300),setTimeout(()=>{location.reload()},1500)):mtShowNotification(e.data||mt_admin.i18n.error_occurred,"error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred,"error")},complete:()=>{s('#mt-auto-assign-modal button[type="submit"]').prop("disabled",!1).text("Run Auto-Assignment")}})},submitManualAssignment:function(){var e=s("#manual_jury_member").val();let t=[];s('input[name="candidate_ids[]"]:checked').each(function(){t.push(s(this).val())}),e&&0!==t.length?s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_manual_assign",nonce:mt_admin.nonce,jury_member_id:e,candidate_ids:t},beforeSend:()=>{s('#mt-manual-assignment-form button[type="submit"]').prop("disabled",!0).text(mt_admin.i18n.processing||"Processing...")},success:e=>{e.success?(mtShowNotification(e.data.message||mt_admin.i18n.assignments_created,"success"),s("#mt-manual-assign-modal").fadeOut(300),setTimeout(()=>{location.reload()},1500)):mtShowNotification(e.data||mt_admin.i18n.error_occurred,"error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred,"error")},complete:()=>{s('#mt-manual-assignment-form button[type="submit"]').prop("disabled",!1).text(mt_admin.i18n.assign_selected)}}):mtShowNotification(mt_admin.i18n.select_jury_and_candidates,"warning")},removeAssignment:function(t){var e=t.data("assignment-id");t.data("jury"),t.data("candidate");confirm(mt_admin.i18n.confirm_remove_assignment)&&s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_remove_assignment",nonce:mt_admin.nonce,assignment_id:e},beforeSend:()=>{t.prop("disabled",!0).text(mt_admin.i18n.processing||"Processing...")},success:e=>{e.success?(t.closest("tr").fadeOut(400,function(){s(this).remove(),0===s(".mt-assignments-table tbody tr").length&&s(".mt-assignments-table tbody").html('<tr><td colspan="8" class="no-items">'+mt_admin.i18n.no_assignments+"</td></tr>")}),mtShowNotification(mt_admin.i18n.assignment_removed,"success")):mtShowNotification(e.data||mt_admin.i18n.error_occurred,"error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred,"error")},complete:()=>{t.prop("disabled",!1).text(mt_admin&&mt_admin.i18n&&mt_admin.i18n.remove?mt_admin.i18n.remove:"Entfernen")}})},clearAllAssignments:function(){confirm(mt_admin.i18n.confirm_clear_all)&&confirm(mt_admin.i18n.confirm_clear_all_second)&&s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_clear_all_assignments",nonce:mt_admin.nonce},beforeSend:()=>{s("#mt-clear-all-btn").prop("disabled",!0).text(mt_admin.i18n.clearing||"Clearing...")},success:e=>{e.success?(mtShowNotification(mt_admin.i18n.all_assignments_cleared,"success"),location.reload()):mtShowNotification(e.data||mt_admin.i18n.error_occurred,"error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred,"error")},complete:()=>{s("#mt-clear-all-btn").prop("disabled",!1).html('<span class="dashicons dashicons-trash"></span> '+mt_admin.i18n.clear_all)}})},exportAssignments:function(){var e=s("<form/>",{action:mt_admin.ajax_url,method:"POST"});e.append(s("<input/>",{type:"hidden",name:"action",value:"mt_export_assignments"})),e.append(s("<input/>",{type:"hidden",name:"nonce",value:mt_admin.nonce})),e.appendTo("body").submit().remove(),mtShowNotification(mt_admin.i18n.export_started,"info")},toggleBulkActions:function(){var e=s("#mt-bulk-actions-container"),t=s(".check-column");e.is(":visible")?(e.slideUp(),t.hide(),s(".mt-assignment-checkbox").prop("checked",!1),s("#mt-select-all-assignments").prop("checked",!1)):(e.slideDown(),t.show())},applyBulkAction:function(){var e=s("#mt-bulk-action-select").val();let t=[];s(".mt-assignment-checkbox:checked").each(function(){t.push(s(this).val())}),e?0===t.length?mtShowNotification(mt_admin.i18n.select_assignments||"Please select at least one assignment","warning"):"remove"===e?this.bulkRemoveAssignments(t):"export"===e?this.bulkExportAssignments(t):"reassign"===e&&this.showReassignModal(t):mtShowNotification(mt_admin.i18n.select_bulk_action||"Please select a bulk action","warning")},bulkRemoveAssignments:function(e){confirm("Are you sure you want to remove the selected assignments?")&&s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_bulk_remove_assignments",nonce:mt_admin.nonce,assignment_ids:e},beforeSend:()=>{s("#mt-apply-bulk-action").prop("disabled",!0).text("Processing...")},success:e=>{e.success?(mtShowNotification(e.data.message||"Assignments removed successfully","success"),location.reload()):mtShowNotification(e.data||"An error occurred","error")},error:()=>{mtShowNotification("An error occurred","error")},complete:()=>{s("#mt-apply-bulk-action").prop("disabled",!1).text("Apply")}})},bulkExportAssignments:function(e){let t=s("<form/>",{action:mt_admin.ajax_url,method:"POST"});t.append(s("<input/>",{type:"hidden",name:"action",value:"mt_export_assignments"})),t.append(s("<input/>",{type:"hidden",name:"nonce",value:mt_admin.nonce})),e.forEach(e=>{t.append(s("<input/>",{type:"hidden",name:"assignment_ids[]",value:e}))}),t.appendTo("body").submit().remove()},filterAssignments:function(t){var n=s(".mt-assignments-table tbody tr");if(t){let e=t.toLowerCase();n.each(function(){s(this).text().toLowerCase().includes(e)?s(this).show():s(this).hide()})}else n.show()},applyFilters:function(){let n=s("#mt-filter-jury").val(),a=s("#mt-filter-status").val();s(".mt-assignments-table tbody tr").each(function(){let e=!0;var t=s(this);n&&t.find(".mt-assignment-checkbox").data("jury-id")!=n&&(e=!1),(e=a&&e&&t.find(".mt-status").text().toLowerCase()!==a?!1:e)?t.show():t.hide()})},showReassignModal:function(e){this.pendingReassignments=e,0===s("#mt-reassign-modal").length&&this.createReassignModal(),s("#mt-reassign-modal").fadeIn(300)},createReassignModal:function(){var e=s("#mt-filter-jury option").clone(),t=`
                <div id="mt-reassign-modal" class="mt-modal" style="display: none;">
                    <div class="mt-modal-content">
                        <h2>${mt_admin.i18n.reassign_assignments||"Reassign Assignments"}</h2>
                        <p>${mt_admin.i18n.reassign_description||"Select a new jury member to reassign the selected assignments to:"}</p>
                        <form id="mt-reassign-form">
                            <div class="mt-form-group">
                                <label for="reassign_jury_member">${mt_admin.i18n.new_jury_member||"New Jury Member"}</label>
                                <select name="new_jury_member_id" id="reassign_jury_member" class="widefat" required>
                                    <option value="">${mt_admin.i18n.select_jury_member||"Select Jury Member"}</option>
                                </select>
                            </div>
                            <div class="mt-modal-actions">
                                <button type="submit" class="button button-primary">${mt_admin.i18n.reassign||"Reassign"}</button>
                                <button type="button" class="button mt-modal-close">${mt_admin.i18n.cancel||"Cancel"}</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;s("body").append(t),s("#reassign_jury_member").html(e),s(document).on("click","#mt-reassign-modal .mt-modal-close",e=>{e.preventDefault(),s("#mt-reassign-modal").fadeOut(300)}),s(document).on("submit","#mt-reassign-form",e=>{e.preventDefault(),this.submitReassignment()})},submitReassignment:function(){var e=s("#reassign_jury_member").val();e?this.pendingReassignments&&0!==this.pendingReassignments.length?s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_bulk_reassign_assignments",nonce:mt_admin.nonce,assignment_ids:this.pendingReassignments,new_jury_member_id:e},beforeSend:()=>{s('#mt-reassign-form button[type="submit"]').prop("disabled",!0).text(mt_admin.i18n.processing||"Processing...")},success:e=>{e.success?(mtShowNotification(e.data.message||"Assignments reassigned successfully","success"),s("#mt-reassign-modal").fadeOut(300),location.reload()):mtShowNotification(e.data||"An error occurred","error")},error:()=>{mtShowNotification(mt_admin.i18n.error_occurred||"An error occurred","error")},complete:()=>{s('#mt-reassign-form button[type="submit"]').prop("disabled",!1).text(mt_admin.i18n.reassign||"Reassign")}}):mtShowNotification(mt_admin.i18n.no_assignments_selected||"No assignments selected","warning"):mtShowNotification(mt_admin.i18n.select_jury_member||"Please select a jury member","warning")}};window.MTEvaluationManager={init:function(){this.bindEvents()},getConfirmMessage:function(e){return{delete:mt_admin.i18n.confirm_delete_evaluations||"Are you sure you want to permanently delete the selected evaluations? This cannot be undone.",approve:mt_admin.i18n.confirm_approve_evaluations||"Are you sure you want to approve the selected evaluations?",reject:mt_admin.i18n.confirm_reject_evaluations||"Are you sure you want to reject the selected evaluations?",reset:mt_admin.i18n.confirm_reset_evaluations||"Are you sure you want to reset the selected evaluations to draft status?",export:mt_admin.i18n.confirm_export_evaluations||"Are you sure you want to export the selected evaluations?"}[e]||"Are you sure you want to "+e+" the selected evaluations?"},bindEvents:function(){s(document).on("click",".view-details",e=>{var e=s(e.currentTarget),t=e.data("evaluation-id");this.viewDetails(t,e)}),s(document).on("click","#cb-select-all-1, #cb-select-all-2",this.handleSelectAll),s('input[name="evaluation[]"]').on("click",this.handleSingleSelect),s(document).on("click","#doaction, #doaction2",e=>{e=s(e.currentTarget).prev("select").val();this.applyBulkAction(e)})},viewDetails:function(e,t){let n=this.createModal();n.data("trigger",t),n.find(".mt-modal-body").html('<div class="mt-loading">Loading evaluation details...</div>'),n.fadeIn(300,function(){n.find(".mt-modal-body").focus()}),s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_get_evaluation_details",nonce:mt_admin.nonce,evaluation_id:e},success:e=>{var t;e.success?(t=this.renderEvaluationDetails(e.data),n.find(".mt-modal-body").html(t)):n.find(".mt-modal-body").html('<div class="notice notice-error"><p>'+(e.data?.message||"Failed to load evaluation details")+"</p></div>")},error:()=>{n.find(".mt-modal-body").html('<div class="notice notice-error"><p>An error occurred while loading evaluation details</p></div>')}})},createModal:function(){let t=s("#mt-evaluation-modal");return 0===t.length&&(s("body").append(`
                    <div id="mt-evaluation-modal" class="mt-modal" role="dialog" aria-modal="true" aria-labelledby="mt-modal-title" style="display:none;">
                        <div class="mt-modal-overlay" aria-hidden="true"></div>
                        <div class="mt-modal-content">
                            <div class="mt-modal-header">
                                <h2 id="mt-modal-title">Evaluation Details</h2>
                                <button class="mt-modal-close" aria-label="Close dialog" type="button">&times;</button>
                            </div>
                            <div class="mt-modal-body" tabindex="0"></div>
                        </div>
                    </div>
                `),(t=s("#mt-evaluation-modal")).find(".mt-modal-close, .mt-modal-overlay").on("click",()=>{this.closeModal(t)}),s(document).on("keydown",e=>{"Escape"===e.key&&t.is(":visible")&&this.closeModal(t)})),t},closeModal:function(e){e.fadeOut(300,function(){e.data("trigger")&&e.data("trigger").focus()})},renderEvaluationDetails:function(e){let t="";for(var[n,a]of Object.entries(e.scores))t+=`
                    <div class="mt-score-item">
                        <label>${a.label}:</label>
                        <span class="mt-score-value">${a.value}/10</span>
                        <div class="mt-score-bar">
                            <div class="mt-score-fill" style="width: ${10*a.value}%"></div>
                        </div>
                    </div>
                `;return`
                <div class="mt-evaluation-details">
                    <div class="mt-detail-section">
                        <h3>Basic Information</h3>
                        <table class="mt-detail-table">
                            <tr>
                                <th>Jury Member:</th>
                                <td>${e.jury_member}</td>
                            </tr>
                            <tr>
                                <th>Candidate:</th>
                                <td>${e.candidate}</td>
                            </tr>
                            <tr>
                                <th>Organization:</th>
                                <td>${e.organization||"-"}</td>
                            </tr>
                            <tr>
                                <th>Categories:</th>
                                <td>${e.categories||"-"}</td>
                            </tr>
                            <tr>
                                <th>Status:</th>
                                <td><span class="mt-status mt-status-${e.status}">${e.status}</span></td>
                            </tr>
                        </table>
                    </div>
                    <div class="mt-detail-section">
                        <h3>Scores</h3>
                        ${t}
                        <div class="mt-score-summary">
                            <strong>${mt_evaluations_i18n.total_score_label||"Total Score:"}</strong> ${e.total_score.toFixed(1)}/50
                            <br>
                            <strong>${mt_evaluations_i18n.average_score_label||"Average Score:"}</strong> ${e.average_score.toFixed(1)}/10
                        </div>
                    </div>
                    ${e.comments?`
                        <div class="mt-detail-section">
                            <h3>Comments</h3>
                            <div class="mt-comments">${e.comments}</div>
                        </div>
                    `:""}
                    <div class="mt-detail-section mt-timestamps">
                        <small>
                            Created: ${e.created_at}<br>
                            Last Updated: ${e.updated_at}
                        </small>
                    </div>
                </div>
            `},handleSelectAll:function(){var e=s(this).prop("checked");s('input[name="evaluation[]"]').prop("checked",e),s("#cb-select-all-1, #cb-select-all-2").prop("checked",e)},handleSingleSelect:function(){var e=s('input[name="evaluation[]"]').length===s('input[name="evaluation[]"]:checked').length;s("#cb-select-all-1, #cb-select-all-2").prop("checked",e)},applyBulkAction:function(t){if("-1"===t)mtShowNotification(mt_admin.i18n.select_bulk_action||"Please select a bulk action","warning");else{let e=[];var n;s('input[name="evaluation[]"]:checked').each(function(){e.push(s(this).val())}),0===e.length?mtShowNotification(mt_admin.i18n.select_assignments||"Please select at least one evaluation","warning"):(n=this.getConfirmMessage(t),confirm(n)&&this.performBulkAction(t,e))}},performBulkAction:function(e,t){let n=s("#doaction, #doaction2"),a=n.first().val(),i=s(".spinner");i.length&&i.addClass("is-active"),s.ajax({url:mt_admin.ajax_url,type:"POST",data:{action:"mt_bulk_evaluation_action",bulk_action:e,evaluation_ids:t,nonce:mt_admin.nonce},beforeSend:function(){n.prop("disabled",!0).val(mt_admin.i18n.processing||"Processing..."),s('input[name="evaluation[]"]:checked').closest("tr").addClass("processing").css("opacity","0.6")},success:function(e){e.success?(mtShowNotification(e.data.message||"Bulk action completed successfully","success"),setTimeout(function(){location.reload()},1e3)):(mtShowNotification(e.data||"An error occurred","error"),s('input[name="evaluation[]"]:checked').closest("tr").removeClass("processing").css("opacity","1"))},error:function(e,t,n){var a=mt_admin.i18n.error_occurred||"An error occurred. Please try again.";mtShowNotification(a+" ("+n+")","error"),s('input[name="evaluation[]"]:checked').closest("tr").removeClass("processing").css("opacity","1")},complete:function(){n.prop("disabled",!1).val(a||"Apply"),i.length&&i.removeClass("is-active")}})}},s(document).ready(function(){a(),s.fn.select2&&s(".mt-select2").select2(),s.fn.datepicker&&s(".mt-datepicker").datepicker({dateFormat:"yy-mm-dd"}),(0<s("#mt-auto-assign-btn").length||0<s(".mt-assignments-table").length)&&t.init(),s("body").hasClass("mobility-trailblazers_page_mt-evaluations")&&window.MTEvaluationManager.init()})})(jQuery);