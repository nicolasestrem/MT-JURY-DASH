jQuery(document).ready(function(r){function a(){var t,e=0,n=0,o=(r(".mt-score-slider").each(function(){var t=parseFloat(r(this).val());isNaN(t)||(e+=t,n++)}),0<n?(e/n).toFixed(1):0);r("#mt-total-score").text(o),o=o,(t=r(".mt-total-score-display")).removeClass("score-low score-medium score-high"),o<4?t.addClass("score-low"):o<7?t.addClass("score-medium"):t.addClass("score-high")}var s=!1;function d(){r("#mt-evaluation-form").on("submit",function(t){if(t.preventDefault(),s)return!1;s=!0;var t=r(this),n=new FormData(this),o=(n.append("action","mt_save_evaluation"),r(".mt-score-slider").each(function(){var t=r(this).attr("name"),e=r(this).val();n.set(t,e)}),t.find('button[type="submit"]')),i=o.html(),t=window.getI18nText?window.getI18nText("submitting","Submitting..."):mt_frontend&&mt_frontend.i18n&&mt_frontend.i18n.submitting?mt_frontend.i18n.submitting:"Submitting...";o.prop("disabled",!0).html('<span class="dashicons dashicons-update spin"></span> '+t),r.ajax({url:mt_ajax.ajax_url,type:"POST",data:n,processData:!1,contentType:!1,success:function(t){var e,n;t.success?(c("success",t.data.message||(window.getI18nText?window.getI18nText("evaluation_submitted","Thank you for submitting your evaluation!"):mt_frontend&&mt_frontend.i18n&&mt_frontend.i18n.evaluation_submitted_full?mt_frontend.i18n.evaluation_submitted_full:mt_frontend&&mt_frontend.i18n&&mt_frontend.i18n.evaluation_submitted?mt_frontend.i18n.evaluation_submitted:"Thank you for submitting your evaluation!")),e="completed",0===(n=r(".mt-status-badge")).length&&(n=r('<span class="mt-status-badge"></span>'),r(".mt-evaluation-title").append(n)),n.removeClass("mt-status-draft mt-status-completed").addClass("mt-status-"+e),"draft"===e?n.text("Draft Saved"):"completed"===e&&(e=mt_frontend&&mt_frontend.i18n&&mt_frontend.i18n.evaluation_submitted_status?mt_frontend.i18n.evaluation_submitted_status:"Evaluation Submitted",n.text(e)),setTimeout(function(){window.location.href=t.data.redirect||window.location.href.split("?")[0]},2e3)):(c("error",t.data||(window.getI18nText?window.getI18nText("error","An error occurred. Please try again."):mt_frontend&&mt_frontend.i18n&&mt_frontend.i18n.error_try_again?mt_frontend.i18n.error_try_again:"An error occurred. Please try again.")),o.prop("disabled",!1).html(i),s=!1)},error:function(){c("error",window.getI18nText?window.getI18nText("network_error","Network error. Please check your connection and try again."):mt_frontend&&mt_frontend.i18n&&mt_frontend.i18n.network_error?mt_frontend.i18n.network_error:"Network error. Please check your connection and try again."),o.prop("disabled",!1).html(i),s=!1}})})}function c(t,e){r(".mt-notification").remove();var n=r('<div class="mt-notification mt-notification-'+t+'"><span class="dashicons dashicons-'+("success"===t?"yes":"warning")+'"></span> '+e+"</div>");r("body").append(n),setTimeout(function(){n.addClass("show")},100),setTimeout(function(){n.removeClass("show"),setTimeout(function(){n.remove()},300)},5e3)}function o(){var t,e,n,o;function i(){var t=n.val().length;o.text(t),1e3<t?o.parent().addClass("over-limit"):o.parent().removeClass("over-limit")}0===r("#mt-critical-fixes-styles").length&&r("head").append(`
                <style id="mt-critical-fixes-styles">
                    /* Slider Styles */
                    .mt-score-slider-container {
                        position: relative;
                        margin: 20px 0;
                    }
                    .mt-score-slider {
                        width: 100%;
                        height: 6px;
                        -webkit-appearance: none;
                        appearance: none;
                        background: #ddd;
                        border-radius: 3px;
                        outline: none;
                    }
                    .mt-score-slider::-webkit-slider-thumb {
                        -webkit-appearance: none;
                        appearance: none;
                        width: 20px;
                        height: 20px;
                        background: #4CAF50;
                        border-radius: 50%;
                        cursor: pointer;
                    }
                    .mt-score-slider::-moz-range-thumb {
                        width: 20px;
                        height: 20px;
                        background: #4CAF50;
                        border-radius: 50%;
                        cursor: pointer;
                        border: none;
                    }
                    .mt-slider-value {
                        position: absolute;
                        top: -25px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: #333;
                        color: white;
                        padding: 2px 8px;
                        border-radius: 3px;
                        font-size: 12px;
                    }
                    /* Score Display */
                    .mt-total-score-display {
                        float: right;
                        font-size: 1.2em;
                        font-weight: bold;
                        padding: 5px 10px;
                        border-radius: 5px;
                        background: #f0f0f0;
                    }
                    .mt-total-score-display.score-low {
                        background: #ffebee;
                        color: #c62828;
                    }
                    .mt-total-score-display.score-medium {
                        background: #fff3e0;
                        color: #ef6c00;
                    }
                    .mt-total-score-display.score-high {
                        background: #e8f5e9;
                        color: #2e7d32;
                    }
                    /* Notification Styles */
                    .mt-notification {
                        position: fixed;
                        top: 50px;
                        right: -300px;
                        background: white;
                        padding: 15px 20px;
                        border-radius: 4px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        z-index: 9999;
                        transition: right 0.3s ease;
                        max-width: 300px;
                    }
                    .mt-notification.show {
                        right: 20px;
                    }
                    .mt-notification-success {
                        border-left: 4px solid #4CAF50;
                        color: #2e7d32;
                    }
                    .mt-notification-error {
                        border-left: 4px solid #f44336;
                        color: #c62828;
                    }
                    /* Character Count */
                    .mt-char-count {
                        text-align: right;
                        font-size: 0.9em;
                        color: #666;
                        margin-top: 5px;
                    }
                    .mt-char-count.over-limit {
                        color: #f44336;
                        font-weight: bold;
                    }
                    /* Loading Spinner */
                    .dashicons.spin {
                        animation: spin 1s linear infinite;
                    }
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                    /* Fix Bio Content */
                    .mt-bio-content:empty::before {
                        content: "Biography information not available.";
                        color: #999;
                        font-style: italic;
                    }
                    .no-content {
                        color: #999;
                        font-style: italic;
                    }
                </style>
            `),r(".mt-button-group").each(function(){var t=r(this),e=t.data("criterion"),n=t.find('input[type="hidden"]').val()||5;t.replaceWith(`
                <div class="mt-score-slider-container">
                    <input type="range" 
                           name="${e}_score" 
                           class="mt-score-slider" 
                           min="0" 
                           max="10" 
                           step="0.5"
                           value="${n}"
                           data-criterion="${e}">
                    <div class="mt-slider-value">${n}</div>
                </div>
            `)}),r(".mt-score-slider").on("input change",function(){var t=r(this),e=t.val();t.siblings(".mt-slider-value").text(e),t.closest(".mt-criterion-card").find(".mt-score-value").text(e),a()}),a(),(e=r(".mt-bio-content")).length&&""===e.text().trim()&&((t=e.data("biography")||r("#candidate-biography").val()||r(".mt-candidate-bio-hidden").text())&&""!==t.trim()?e.html("<p>"+t+"</p>"):e.html('<p class="no-content">No biography available for this candidate.</p>')),d(),n=r("#mt-comments"),o=r("#mt-char-current"),n.on("input keyup",i),i()}0<r(".mt-evaluation-form, #mt-evaluation-form").length&&o(),r(document).ajaxComplete(function(t,e,n){n.url&&n.url.includes("evaluate")&&setTimeout(o,100)})});