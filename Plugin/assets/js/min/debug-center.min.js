!function(t){"use strict";const e={ajaxUrl:mt_debug.ajax_url||ajaxurl,nonce:mt_debug.nonce,activeTab:null,init:function(){this.bindEvents(),this.initActiveTab(),this.initTooltips(),this.startAutoRefresh()},bindEvents:function(){t(document).on("click",".nav-tab",this.handleTabClick.bind(this)),t(document).on("submit",".diagnostic-form",this.handleDiagnosticSubmit.bind(this)),t(document).on("click",".mt-run-diagnostic",this.runDiagnostic.bind(this)),t(document).on("click",".mt-export-diagnostics",this.exportDiagnostics.bind(this)),t(document).on("click",".mt-execute-script",this.executeScript.bind(this)),t(document).on("click",".mt-run-maintenance",this.runMaintenance.bind(this)),t(document).on("click",".mt-copy-sysinfo",this.copySystemInfo.bind(this)),t(document).on("click",".mt-export-sysinfo",this.exportSystemInfo.bind(this)),t(document).on("click",".mt-refresh-widget",this.refreshWidget.bind(this))},initActiveTab:function(){const t=new URLSearchParams(window.location.search);this.activeTab=t.get("tab")||"diagnostics"},initTooltips:function(){t.fn.tooltip&&t(".mt-tooltip").tooltip({position:{my:"center bottom-10",at:"center top"}})},startAutoRefresh:function(){setInterval(()=>{"diagnostics"===this.activeTab&&this.refreshWidget({target:t('[data-widget="system_status"]')[0]})},3e4)},handleTabClick:function(e){const i=t(e.currentTarget).attr("href").match(/tab=([^&]+)/);i&&(this.activeTab=i[1])},handleDiagnosticSubmit:function(t){t.preventDefault(),this.runDiagnostic(t)},runDiagnostic:function(e){e.preventDefault();const i=t(e.currentTarget),s=i.is("form")?i.find('button[name="run_diagnostic"]'):i,n=s.closest("form").find("#diagnostic_type").val()||"full";s.prop("disabled",!0).addClass("updating-message");const o=s.text();s.text(mt_debug.i18n.running||"Running..."),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"mt_run_diagnostic",nonce:this.nonce,diagnostic_type:n},success:t=>{t.success?(this.displayDiagnosticResults(t.data),this.showNotification(mt_debug.i18n.diagnostic_complete||"Diagnostic complete","success")):this.showNotification(t.data||mt_debug.i18n.diagnostic_failed||"Diagnostic failed","error")},error:()=>{this.showNotification(mt_debug.i18n.network_error||"Network error occurred","error")},complete:()=>{s.prop("disabled",!1).removeClass("updating-message").text(o)}})},displayDiagnosticResults:function(e){let i=t(".mt-diagnostics-tab .diagnostic-results");i.length||(i=t('<div class="diagnostic-results mt-debug-section"></div>'),t(".mt-diagnostics-tab").append(i));let s="<h3>"+(mt_debug.i18n.diagnostic_results||"Diagnostic Results")+"</h3>";if(s+='<div class="mt-diagnostic-timestamp">Run at: '+(e.timestamp||(new Date).toLocaleString())+"</div>",e.diagnostics)for(const[t,i]of Object.entries(e.diagnostics)){if(s+='<div class="mt-diagnostic-section">',s+="<h4>"+this.formatSectionName(t)+"</h4>",s+='<div class="mt-diagnostic-items">',"object"==typeof i&&null!==i)for(const[t,e]of Object.entries(i)){const i=this.getDiagnosticStatus(t,e);s+='<div class="mt-diagnostic-item '+i.class+'">',s+='<span class="mt-diagnostic-label">'+this.formatLabel(t)+":</span>",s+='<span class="mt-diagnostic-value">'+this.formatValue(e)+"</span>",i.icon&&(s+='<span class="dashicons '+i.icon+'"></span>'),s+="</div>"}else s+='<div class="mt-diagnostic-item">'+i+"</div>";s+="</div></div>"}i.html(s),t("html, body").animate({scrollTop:i.offset().top-100},500)},formatSectionName:function(t){return t.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())},formatLabel:function(t){return t.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())},formatValue:function(t){return"boolean"==typeof t?t?"✓ Yes":"✗ No":"object"==typeof t&&null!==t?JSON.stringify(t,null,2):String(t)},getDiagnosticStatus:function(t,e){return t.includes("error")||t.includes("failed")?{class:"mt-diagnostic-error",icon:"dashicons-warning"}:t.includes("warning")||t.includes("deprecated")?{class:"mt-diagnostic-warning",icon:"dashicons-info"}:!0===e||t.includes("success")||t.includes("valid")?{class:"mt-diagnostic-success",icon:"dashicons-yes-alt"}:!1===e||t.includes("invalid")?{class:"mt-diagnostic-error",icon:"dashicons-dismiss"}:{class:"",icon:""}},exportDiagnostics:function(e){e.preventDefault();const i=t(e.currentTarget);i.prop("disabled",!0),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"mt_export_diagnostics",nonce:this.nonce},success:t=>{t.success?(this.downloadJSON(t.data.data,t.data.filename),this.showNotification(mt_debug.i18n.export_complete||"Export complete","success")):this.showNotification(t.data||mt_debug.i18n.export_failed||"Export failed","error")},error:()=>{this.showNotification(mt_debug.i18n.network_error||"Network error occurred","error")},complete:()=>{i.prop("disabled",!1)}})},executeScript:function(e){e.preventDefault();const i=t(e.currentTarget),s=i.data("script"),n=i.data("dangerous");n&&!confirm(mt_debug.i18n.confirm_dangerous||"This is a dangerous operation. Are you sure?")||(i.prop("disabled",!0).addClass("updating-message"),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"mt_execute_debug_script",nonce:this.nonce,script:s,params:{confirm:!!n}},success:t=>{t.success?(this.showScriptOutput(t.data),this.showNotification(mt_debug.i18n.script_complete||"Script executed","success")):t.data&&t.data.requires_confirmation?confirm(t.data.message)&&this.executeScript(e):this.showNotification(t.data||mt_debug.i18n.script_failed||"Script failed","error")},error:()=>{this.showNotification(mt_debug.i18n.network_error||"Network error occurred","error")},complete:()=>{i.prop("disabled",!1).removeClass("updating-message")}}))},showScriptOutput:function(e){const i=t('<div class="mt-modal">').html(`\n                <div class="mt-modal-content">\n                    <h3>${mt_debug.i18n.script_output||"Script Output"}</h3>\n                    <div class="mt-script-output">${e.output||"<p>No output generated</p>"}</div>\n                    ${e.errors&&e.errors.length?`<div class="notice notice-error">\n                            <p>${mt_debug.i18n.errors_occurred||"Errors occurred"}:</p>\n                            <ul>${e.errors.map(t=>`<li>${this.escapeHtml(t.message)}</li>`).join("")}</ul>\n                        </div>`:""}\n                    <button class="button mt-close-modal">${mt_debug.i18n.close||"Close"}</button>\n                </div>\n            `);t("body").append(i),i.on("click",".mt-close-modal, .mt-modal",function(e){(e.target===this||t(e.target).hasClass("mt-close-modal"))&&i.remove()})},runMaintenance:function(e){e.preventDefault();const i=t(e.currentTarget),s=i.data("category"),n=i.data("operation"),o=i.data("dangerous");o&&!confirm(mt_debug.i18n.confirm_dangerous||"This is a dangerous operation. Are you sure?")||(i.prop("disabled",!0).addClass("updating-message"),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"mt_run_maintenance",nonce:this.nonce,category:s,operation:n,params:{confirm:!!o}},success:t=>{t.success?(this.showNotification(t.data.message||mt_debug.i18n.operation_complete||"Operation complete","success"),t.data.data):t.data&&t.data.requires_password?this.promptPassword(s,n):this.showNotification(t.data||mt_debug.i18n.operation_failed||"Operation failed","error")},error:()=>{this.showNotification(mt_debug.i18n.network_error||"Network error occurred","error")},complete:()=>{i.prop("disabled",!1).removeClass("updating-message")}}))},promptPassword:function(e,i){const s=prompt(mt_debug.i18n.enter_password||"Enter your admin password:");s&&t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"mt_run_maintenance",nonce:this.nonce,category:e,operation:i,params:{confirm:!0,password:s}},success:t=>{t.success?this.showNotification(t.data.message||mt_debug.i18n.operation_complete||"Operation complete","success"):this.showNotification(t.data||mt_debug.i18n.operation_failed||"Operation failed","error")}})},refreshWidget:function(e){e.preventDefault();const i=t(e.target).closest(".mt-widget"),s=i.data("widget");i.addClass("updating"),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"mt_refresh_debug_widget",nonce:this.nonce,widget_id:s},success:t=>{t.success&&i.find(".mt-widget-content").html(t.data.html)},complete:()=>{i.removeClass("updating")}})},downloadJSON:function(t,e){const i=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(i),n=document.createElement("a");n.href=s,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},showNotification:function(e,i="info"){const s=t(`\n                <div class="notice notice-${i} is-dismissible mt-notification">\n                    <p>${e}</p>\n                    <button type="button" class="notice-dismiss">\n                        <span class="screen-reader-text">${mt_debug.i18n.dismiss||"Dismiss"}</span>\n                    </button>\n                </div>\n            `);t(".wrap h1").first().after(s),setTimeout(()=>{s.fadeOut(()=>s.remove())},5e3),s.on("click",".notice-dismiss",function(){s.fadeOut(()=>s.remove())})},escapeHtml:function(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,t=>e[t])},copySystemInfo:function(e){e.preventDefault();t(e.currentTarget);const i=t("#system-info-export");i.length&&(i[0].select(),document.execCommand("copy"),this.showNotification(mt_debug.i18n.copied||"Copied to clipboard","success"))},exportSystemInfo:function(e){e.preventDefault(),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"mt_get_system_info",nonce:this.nonce},success:t=>{if(t.success){const e="mt-sysinfo-"+(new Date).toISOString().slice(0,10)+".json";this.downloadJSON(JSON.stringify(t.data,null,2),e)}}})}};t(document).ready(function(){t(".mt-debug-center").length&&e.init()})}(jQuery);
//# sourceMappingURL=debug-center.js.map