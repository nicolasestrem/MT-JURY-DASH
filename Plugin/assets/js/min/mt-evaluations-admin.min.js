(i=>{window.MTEvaluations={init:function(){this.bindEvents(),this.setupBulkActions()},bindEvents:function(){var a=this;i(document).on("click",".view-details",function(t){t.preventDefault();t=i(this).data("evaluation-id");a.showDetails(t)}),i(document).on("click",".mt-delete-evaluation",function(t){t.preventDefault();t=i(this).data("id");confirm(mt_evaluations_i18n.confirm_delete||"Are you sure you want to delete this evaluation?")&&a.deleteEvaluation(t)}),i(document).on("click",".mt-modal-close, .mt-modal-overlay",function(t){(i(t.target).hasClass("mt-modal-close")||i(t.target).hasClass("mt-modal-overlay"))&&a.closeModal()}),i(document).on("keydown",function(t){27===t.keyCode&&i("#mt-evaluation-modal").length&&a.closeModal()})},setupBulkActions:function(){var o=this;i("#doaction, #doaction2").on("click",function(t){var a,e=i(this).prev("select").val();"-1"!==e&&(t.preventDefault(),a=[],i('input[name="evaluation[]"]:checked').each(function(){a.push(i(this).val())}),0===a.length?alert(mt_evaluations_i18n.no_selection||"Please select at least one evaluation."):"delete"===e&&!confirm(mt_evaluations_i18n.confirm_bulk_delete||"Are you sure you want to delete the selected evaluations?")||o.bulkAction(e,a))}),i("#cb-select-all-1, #cb-select-all-2").on("change",function(){var t=i(this).prop("checked");i('input[name="evaluation[]"]').prop("checked",t),i("#cb-select-all-1, #cb-select-all-2").prop("checked",t)})},showDetails:function(t){var a=this;a.showLoading(),i.ajax({url:ajaxurl,type:"POST",data:{action:"mt_get_evaluation_details",evaluation_id:t,nonce:mt_evaluations_vars.nonce||i("#_wpnonce").val()},success:function(t){t.success&&t.data?a.displayModal(t.data):(a.closeModal(),alert(t.data||"Failed to load evaluation details."))},error:function(){a.closeModal(),alert("Error loading evaluation details.")}})},displayModal:function(t){i("#mt-evaluation-modal-wrapper").remove();var o="",a=(t.scores&&i.each(t.scores,function(t,a){var e=a.value/10*100;o+=`
                        <div class="mt-score-row">
                            <div class="mt-score-label">${a.label}</div>
                            <div class="mt-score-bar">
                                <div class="mt-score-fill" style="width: ${e}%"></div>
                            </div>
                            <div class="mt-score-value">${a.value.toFixed(1)}</div>
                        </div>
                    `}),`
                <div id="mt-evaluation-modal-wrapper" class="mt-modal-wrapper">
                    <div class="mt-modal-overlay"></div>
                    <div id="mt-evaluation-modal" class="mt-modal">
                        <div class="mt-modal-header">
                            <h2>${mt_evaluations_i18n.evaluation_details||"Evaluation Details"} #${t.id}</h2>
                            <button type="button" class="mt-modal-close" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="mt-modal-body">
                            <div class="mt-evaluation-info">
                                <table class="widefat striped">
                                    <tbody>
                                        <tr>
                                            <th>${mt_evaluations_i18n.jury_member||"Jury Member"}:</th>
                                            <td>${t.jury_member}</td>
                                        </tr>
                                        <tr>
                                            <th>${mt_evaluations_i18n.candidate||"Candidate"}:</th>
                                            <td>${t.candidate}</td>
                                        </tr>
                                        ${t.organization?`
                                        <tr>
                                            <th>${mt_evaluations_i18n.organization||"Organization"}:</th>
                                            <td>${t.organization}</td>
                                        </tr>`:""}
                                        ${t.categories?`
                                        <tr>
                                            <th>${mt_evaluations_i18n.categories||"Categories"}:</th>
                                            <td>${t.categories}</td>
                                        </tr>`:""}
                                        <tr>
                                            <th>${mt_evaluations_i18n.status||"Status"}:</th>
                                            <td><span class="mt-status mt-status-${t.status}">${t.status}</span></td>
                                        </tr>
                                        <tr>
                                            <th>${mt_evaluations_i18n.created||"Created"}:</th>
                                            <td>${t.created_at}</td>
                                        </tr>
                                        <tr>
                                            <th>${mt_evaluations_i18n.updated||"Last Updated"}:</th>
                                            <td>${t.updated_at}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="mt-evaluation-scores">
                                <h3>${mt_evaluations_i18n.scores||"Evaluation Scores"}</h3>
                                ${o}
                                <div class="mt-score-summary">
                                    <div class="mt-total-score">
                                        <strong>${mt_evaluations_i18n.total_score||"Total Score"}:</strong>
                                        <span class="mt-score-total">${t.total_score.toFixed(1)} / 50</span>
                                    </div>
                                    <div class="mt-average-score">
                                        <strong>${mt_evaluations_i18n.average_score||"Average"}:</strong>
                                        <span class="mt-score-average">${t.average_score.toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                            
                            ${t.comments?`
                            <div class="mt-evaluation-comments">
                                <h3>${mt_evaluations_i18n.comments||"Comments"}</h3>
                                <div class="mt-comments-text">${t.comments}</div>
                            </div>`:""}
                        </div>
                        <div class="mt-modal-footer">
                            <button type="button" class="button button-primary mt-modal-close">
                                ${mt_evaluations_i18n.close||"Close"}
                            </button>
                            <button type="button" class="button button-link-delete mt-delete-evaluation" data-id="${t.id}">
                                ${mt_evaluations_i18n.delete||"Delete Evaluation"}
                            </button>
                        </div>
                    </div>
                </div>
            `);i("body").append(a),i(document).trigger("mt:evaluation:modal:opened",[t])},showLoading:function(){var t=`
                <div id="mt-evaluation-modal-wrapper" class="mt-modal-wrapper">
                    <div class="mt-modal-overlay"></div>
                    <div class="mt-modal-loading">
                        <div class="spinner is-active"></div>
                        <p>${mt_evaluations_i18n.loading||"Loading..."}</p>
                    </div>
                </div>
            `;i("body").append(t)},closeModal:function(){i("#mt-evaluation-modal-wrapper").fadeOut(200,function(){i(this).remove()}),i(document).trigger("mt:evaluation:modal:closed")},deleteEvaluation:function(a){var e=this;i.ajax({url:ajaxurl,type:"POST",data:{action:"mt_delete_evaluation",evaluation_id:a,nonce:mt_evaluations_vars.nonce||i("#_wpnonce").val()},success:function(t){t.success?(e.closeModal(),i('input[value="'+a+'"][name="evaluation[]"]').closest("tr").fadeOut(400,function(){i(this).remove(),0===i('input[name="evaluation[]"]').length&&location.reload()}),e.showNotice(t.data.message||"Evaluation deleted successfully","success")):alert(t.data||"Failed to delete evaluation")},error:function(){alert("Error deleting evaluation")}})},bulkAction:function(t,a){i.ajax({url:ajaxurl,type:"POST",data:{action:"mt_bulk_evaluation_action",bulk_action:t,evaluation_ids:a,nonce:mt_evaluations_vars.nonce||i("#_wpnonce").val()},success:function(t){t.success?location.reload():alert(t.data||"Failed to perform bulk action")},error:function(){alert("Error performing bulk action")}})},showNotice:function(t,a){a=`
                <div class="notice notice-${a} is-dismissible mt-admin-notice">
                    <p>${t}</p>
                    <button type="button" class="notice-dismiss">
                        <span class="screen-reader-text">Dismiss this notice.</span>
                    </button>
                </div>
            `;i(".mt-admin-notice").remove(),i(".wrap > h1").after(a),setTimeout(function(){i(".mt-admin-notice").fadeOut(400,function(){i(this).remove()})},5e3),i(".mt-admin-notice .notice-dismiss").on("click",function(){i(this).closest(".notice").fadeOut(400,function(){i(this).remove()})})}},i(document).ready(function(){(0<i(".view-details[data-evaluation-id]").length||window.location.href.includes("page=mt-evaluations"))&&MTEvaluations.init()})})(jQuery);