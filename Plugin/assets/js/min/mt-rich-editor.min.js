((o,i)=>{o.MTRichEditor={config:{maxHistorySize:50,autosaveInterval:3e4,supportedTags:["p","br","strong","b","em","i","u","h1","h2","h3","ul","ol","li","a","blockquote"],toolbarButtons:[]},getToolbarButtons:function(){var t=(o.mt_editor_i18n||{}).toolbar||{};return[{command:"bold",icon:"dashicons-editor-bold",title:t.bold||"Bold (Ctrl+B)",shortcut:"Ctrl+B"},{command:"italic",icon:"dashicons-editor-italic",title:t.italic||"Italic (Ctrl+I)",shortcut:"Ctrl+I"},{command:"underline",icon:"dashicons-editor-underline",title:t.underline||"Underline (Ctrl+U)",shortcut:"Ctrl+U"},{type:"separator"},{command:"heading",icon:"dashicons-heading",title:t.headings||"Headings",type:"dropdown"},{type:"separator"},{command:"insertUnorderedList",icon:"dashicons-editor-ul",title:t.unordered_list||"Bullet List"},{command:"insertOrderedList",icon:"dashicons-editor-ol",title:t.ordered_list||"Numbered List"},{type:"separator"},{command:"createLink",icon:"dashicons-admin-links",title:t.insert_link||"Insert Link (Ctrl+K)",shortcut:"Ctrl+K"},{command:"unlink",icon:"dashicons-editor-unlink",title:t.remove_link||"Remove Link"},{type:"separator"},{command:"removeFormat",icon:"dashicons-editor-removeformatting",title:t.remove_format||"Clear Formatting"},{type:"separator"},{command:"undo",icon:"dashicons-undo",title:t.undo||"Undo (Ctrl+Z)",shortcut:"Ctrl+Z"},{command:"redo",icon:"dashicons-redo",title:t.redo||"Redo (Ctrl+Y)",shortcut:"Ctrl+Y"}]},editors:{},history:{},historyIndex:{},isSupported:function(){return"contentEditable"in i.body&&"function"==typeof i.execCommand},init:function(t,e){var n,r;return e=e||{},this.isSupported()?(r=i.getElementById(t))?(n=this.createEditorStructure(t,e),r.innerHTML="",r.appendChild(n),r=n.querySelector(".mt-rich-editor-content"),this.editors[t]=r,this.history[t]=[],this.historyIndex[t]=-1,e.content&&(r.innerHTML=this.sanitizeHTML(e.content),this.saveHistory(t)),this.bindEditorEvents(t,r),this.bindToolbarEvents(t,n),e.autosave&&e.onAutosave&&this.startAutosave(t,e.onAutosave),r):null:this.initFallback(t,e)},createEditorStructure:function(t,e){var n=i.createElement("div"),t=(n.className="mt-rich-editor-wrapper",n.setAttribute("data-editor-id",t),this.createToolbar(t)),t=(n.appendChild(t),i.createElement("div")),e=(t.className="mt-rich-editor-content",t.contentEditable=!0,t.setAttribute("role","textbox"),t.setAttribute("aria-multiline","true"),t.setAttribute("aria-label",e.label||"Rich text editor"),e.minHeight&&(t.style.minHeight=e.minHeight+"px"),e.maxHeight&&(t.style.maxHeight=e.maxHeight+"px"),n.appendChild(t),i.createElement("div"));return e.className="mt-rich-editor-status",e.innerHTML='<span class="mt-char-count">0 characters</span>',n.appendChild(e),n},createToolbar:function(t){let n=i.createElement("div");return n.className="mt-rich-editor-toolbar",n.setAttribute("role","toolbar"),this.getToolbarButtons().forEach(t=>{var e;"separator"===t.type?((e=i.createElement("span")).className="mt-toolbar-separator",n.appendChild(e)):"dropdown"===t.type?(e=this.createDropdown(t),n.appendChild(e)):(e=this.createToolbarButton(t),n.appendChild(e))}),n},createToolbarButton:function(t){var e=i.createElement("button"),n=(e.type="button",e.className="mt-toolbar-button",e.setAttribute("data-command",t.command),e.setAttribute("title",t.title),e.setAttribute("aria-label",t.title),i.createElement("span"));return n.className="dashicons "+t.icon,e.appendChild(n),e},createDropdown:function(t){var e=i.createElement("div"),n=(e.className="mt-toolbar-dropdown",i.createElement("button")),r=(n.type="button",n.className="mt-toolbar-button mt-dropdown-toggle",n.setAttribute("data-command",t.command),n.setAttribute("title",t.title),i.createElement("span")),t=(r.className="dashicons "+t.icon,n.appendChild(r),i.createElement("div"));t.className="mt-dropdown-menu";r=(o.mt_editor_i18n||{}).dropdown||{};return t.innerHTML=`
                <button type="button" data-heading="p">${r.normal_text||"Normal Text"}</button>
                <button type="button" data-heading="h1">${r.heading_1||"Heading 1"}</button>
                <button type="button" data-heading="h2">${r.heading_2||"Heading 2"}</button>
                <button type="button" data-heading="h3">${r.heading_3||"Heading 3"}</button>
            `,e.appendChild(n),e.appendChild(t),e},bindEditorEvents:function(e,t){let n=this;t.addEventListener("input",function(){n.updateCharCount(e),n.saveHistory(e)}),t.addEventListener("keydown",function(t){n.handleKeyboardShortcuts(t,e)}),t.addEventListener("paste",function(t){n.handlePaste(t,e)}),t.addEventListener("focus",function(){this.parentElement.classList.add("focused")}),t.addEventListener("blur",function(){this.parentElement.classList.remove("focused")})},bindToolbarEvents:function(e,t){let n=this,r=t.querySelector(".mt-rich-editor-toolbar");r.querySelectorAll(".mt-toolbar-button:not(.mt-dropdown-toggle)").forEach(t=>{t.addEventListener("click",function(t){t.preventDefault();t=this.getAttribute("data-command");n.executeCommand(e,t)})}),r.querySelectorAll(".mt-dropdown-toggle").forEach(t=>{t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),this.nextElementSibling.classList.toggle("show")})}),r.querySelectorAll(".mt-dropdown-menu button").forEach(t=>{t.addEventListener("click",function(t){t.preventDefault();t=this.getAttribute("data-heading");n.formatHeading(e,t),this.parentElement.classList.remove("show")})}),i.addEventListener("click",function(){r.querySelectorAll(".mt-dropdown-menu.show").forEach(t=>{t.classList.remove("show")})})},executeCommand:function(t,e,n){var r=this.editors[t];if(r){switch(r.focus(),e){case"createLink":this.insertLink(t);break;case"undo":this.undo(t);break;case"redo":this.redo(t);break;case"removeFormat":i.execCommand("removeFormat",!1,null),i.execCommand("formatBlock",!1,"p");break;default:i.execCommand(e,!1,n||null)}this.saveHistory(t),this.updateToolbarState(t)}},formatHeading:function(t,e){var n=this.editors[t];n&&(n.focus(),i.execCommand("formatBlock",!1,e),this.saveHistory(t),this.updateToolbarState(t))},insertLink:function(t){var e=(o.mt_editor_i18n||{}).prompts||{},e=prompt(e.enter_url||"Enter URL:","https://");e&&"https://"!==e&&(i.execCommand("createLink",!1,e),this.editors[t].querySelectorAll('a[href="'+e+'"]').forEach(t=>{t.target="_blank",t.rel="noopener noreferrer"}))},handleKeyboardShortcuts:function(t,e){if(t.ctrlKey||t.metaKey)switch(t.key.toLowerCase()){case"b":t.preventDefault(),this.executeCommand(e,"bold");break;case"i":t.preventDefault(),this.executeCommand(e,"italic");break;case"u":t.preventDefault(),this.executeCommand(e,"underline");break;case"k":t.preventDefault(),this.executeCommand(e,"createLink");break;case"z":t.shiftKey||(t.preventDefault(),this.undo(e));break;case"y":t.preventDefault(),this.redo(e)}},handlePaste:function(t,e){t.preventDefault();let n="";t.clipboardData?n=t.clipboardData.getData("text/html")||t.clipboardData.getData("text/plain"):o.clipboardData&&(n=o.clipboardData.getData("Text"));t=this.sanitizeHTML(n);i.execCommand("insertHTML",!1,t),this.saveHistory(e)},sanitizeHTML:function(t){var e=i.createElement("div");return e.innerHTML=t,e.querySelectorAll("script, style, meta, link").forEach(t=>t.remove()),e.querySelectorAll("*").forEach(e=>{let n=["href","target","rel","title","alt"];for(var t in Array.from(e.attributes).forEach(t=>{n.includes(t.name)||t.name.startsWith("data-")||e.removeAttribute(t.name)}),e)t.startsWith("on")&&(e[t]=null)}),e.querySelectorAll("p").forEach(t=>{t.textContent.trim()||t.querySelector("br")||t.remove()}),e.innerHTML},saveHistory:function(t){var e,n,r=this.editors[t];r&&(r=r.innerHTML,e=this.history[t],n=this.historyIndex[t],e.splice(n+1),e.push(r),e.length>this.config.maxHistorySize&&e.shift(),this.historyIndex[t]=e.length-1)},undo:function(t){var e=this.history[t],n=this.historyIndex[t];0<n&&(this.historyIndex[t]=--n,this.editors[t].innerHTML=e[n],this.updateToolbarState(t))},redo:function(t){var e=this.history[t],n=this.historyIndex[t];n<e.length-1&&(this.historyIndex[t]=++n,this.editors[t].innerHTML=e[n],this.updateToolbarState(t))},updateToolbarState:function(t){var e,n=i.querySelector('[data-editor-id="'+t+'"]');n&&((n=n.querySelector(".mt-rich-editor-toolbar")).querySelectorAll(".mt-toolbar-button").forEach(t=>{var e=t.getAttribute("data-command");e&&"undo"!==e&&"redo"!==e&&(e=i.queryCommandState(e),t.classList.toggle("active",e))}),e=n.querySelector('[data-command="undo"]'),n=n.querySelector('[data-command="redo"]'),e&&(e.disabled=this.historyIndex[t]<=0),n)&&(n.disabled=this.historyIndex[t]>=this.history[t].length-1)},updateCharCount:function(t){var e=this.editors[t],t=i.querySelector('[data-editor-id="'+t+'"]');e&&t&&(e=e.textContent.length,t=t.querySelector(".mt-char-count"))&&(t.textContent=e+" characters")},getContent:function(t){t=this.editors[t];return t?this.sanitizeHTML(t.innerHTML):""},setContent:function(t,e){var n=this.editors[t];n&&(n.innerHTML=this.sanitizeHTML(e),this.saveHistory(t),this.updateCharCount(t))},startAutosave:function(e,n){let r=this;setInterval(function(){var t=r.getContent(e);t&&n(t)},this.config.autosaveInterval)},initFallback:function(t,e){var n,r=i.getElementById(t);return r?((n=i.createElement("textarea")).className="mt-rich-editor-fallback",n.id=t+"-fallback",n.rows=10,e.content&&(n.value=this.stripHTML(e.content)),r.innerHTML="",r.appendChild(n),(t=i.createElement("div")).className="mt-editor-help",t.innerHTML="Use **text** for bold, *text* for italic, and [text](url) for links.",r.appendChild(t),n):null},stripHTML:function(t){var e=i.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},destroy:function(t){delete this.editors[t],delete this.history[t],delete this.historyIndex[t];t=i.getElementById(t);t&&(t.innerHTML="")}}})(window,document);