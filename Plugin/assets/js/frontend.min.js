!function(a){"use strict";"undefined"==typeof mt_ajax&&(window.mt_ajax={ajax_url:"/wp-admin/admin-ajax.php",nonce:"",i18n:{error:"An error occurred",success:"Success",loading:"Loading...",confirm:"Are you sure?"}}),mt_ajax.ajax_url||(mt_ajax.ajax_url="/wp-admin/admin-ajax.php"),mt_ajax.i18n||(mt_ajax.i18n={}),window.getI18nText=function(a,t){if("undefined"!=typeof mt_frontend_i18n&&mt_frontend_i18n&&mt_frontend_i18n.ui&&mt_frontend_i18n.ui[a])return mt_frontend_i18n.ui[a];if("undefined"!=typeof mt_ajax&&mt_ajax&&mt_ajax.i18n&&mt_ajax.i18n[a])return mt_ajax.i18n[a];if("undefined"!=typeof mt_frontend&&mt_frontend&&mt_frontend.i18n&&mt_frontend.i18n[a])return mt_frontend.i18n[a];var n={evaluation_submitted_full:"evaluation_submitted"};return n[a]?window.getI18nText(n[a],t):t||""};var t=window.getI18nText;if(window.addEventListener("error",function(a){window.MTErrorHandler&&MTErrorHandler.logError("JavaScript Error",{message:a.message,filename:a.filename,lineno:a.lineno,colno:a.colno,stack:a.error?a.error.stack:"No stack trace available"})}),window.mtIntervals=window.mtIntervals||{},window.mtTimeouts=window.mtTimeouts||{},window.mtEventListeners=window.mtEventListeners||[],window.mtCleanup=function(){if(window.mtIntervals)for(var a in window.mtIntervals)window.mtIntervals.hasOwnProperty(a)&&(clearInterval(window.mtIntervals[a]),window.mtIntervals[a]=null);if(window.mtEventListeners&&window.mtEventListeners.length>0&&(window.mtEventListeners.forEach(function(a){a.element&&a.element.removeEventListener&&a.element.removeEventListener(a.event,a.handler)}),window.mtEventListeners=[]),"undefined"!=typeof jQuery&&(jQuery("*").stop(!0,!0),jQuery(".mt-tooltip").remove(),jQuery(".mt-alert").remove()),window.mtTimeouts)for(var t in window.mtTimeouts)window.mtTimeouts.hasOwnProperty(t)&&(clearTimeout(window.mtTimeouts[t]),window.mtTimeouts[t]=null)},window.addEventListener("beforeunload",function(){window.mtCleanup()}),document.addEventListener("visibilitychange",function(){if(document.hidden){if(window.mtIntervals)for(var a in window.mtPausedIntervals={},window.mtIntervals)window.mtIntervals.hasOwnProperty(a)&&window.mtIntervals[a]&&(clearInterval(window.mtIntervals[a]),window.mtPausedIntervals[a]=!0)}else window.mtPausedIntervals&&(window.mtPausedIntervals.rankingsRefresh&&(window.mtIntervals.rankingsRefresh=setInterval(function(){"undefined"!=typeof jQuery&&jQuery("#mt-rankings-container").length>0&&jQuery.ajax({url:mt_ajax.ajax_url,type:"POST",data:{action:"mt_get_jury_rankings",nonce:mt_ajax.nonce,limit:10},success:function(a){a.success&&a.data.html&&(jQuery("#mt-rankings-container").html(a.data.html),jQuery(".mt-ranking-item:visible").each(function(a){a<20&&jQuery(this).css("opacity","0").delay(50*a).animate({opacity:1},300)}))},error:function(){}})},6e4)),window.mtPausedIntervals.inlineRankingsRefresh&&jQuery(".mt-rankings-section").length>0&&(window.mtIntervals.inlineRankingsRefresh=setInterval(function(){"undefined"!=typeof jQuery&&jQuery(".mt-rankings-section").length>0&&jQuery("#mt-rankings-container").length>0&&jQuery.ajax({url:mt_ajax.ajax_url,type:"POST",data:{action:"mt_get_jury_rankings",nonce:mt_ajax.nonce,limit:10},success:function(a){a.success&&a.data.html&&jQuery("#mt-rankings-container").html(a.data.html)},error:function(){}})},3e4)),window.mtPausedIntervals={})}),window.location.href.includes("evaluate=")){var n=document.referrer;n&&(n.includes("action=edit")||n.includes("action=elementor"))?sessionStorage.getItem("mt_evaluation_refreshed")||(sessionStorage.setItem("mt_evaluation_refreshed","true"),window.location.reload(!0)):sessionStorage.removeItem("mt_evaluation_refreshed")}window.MTErrorHandler={logError:function(a,t){(new Date).toISOString(),window.location.href,navigator.userAgent;window.console&&console.error},showUserError:function(t,n){var e=a('<div class="mt-alert '+("warning"===(n=n||"error")?"mt-alert-warning":"mt-alert-error")+'"><span class="mt-alert-message">'+t+'</span><button class="mt-alert-close" type="button">&times;</button></div>');a(".mt-alert").remove(),a("body").prepend(e),window.mtTimeouts.alertAutoRemove&&clearTimeout(window.mtTimeouts.alertAutoRemove),window.mtTimeouts.alertAutoRemove=setTimeout(function(){e.fadeOut(function(){e.remove()}),delete window.mtTimeouts.alertAutoRemove},5e3),e.find(".mt-alert-close").on("click",function(){e.fadeOut(function(){e.remove()})})},handleAjaxError:function(a,n,e,s){var r=t("error","An error occurred. Please try again."),i={status:n,error:e,responseText:a.responseText,context:s||"Unknown"};try{a.responseJSON&&a.responseJSON.data&&a.responseJSON.data.message?r=a.responseJSON.data.message:a.responseJSON&&a.responseJSON.message?r=a.responseJSON.message:"timeout"===n?r=t("request_timeout","Request timed out. Please check your connection and try again."):"abort"===n?r=t("request_cancelled","Request was cancelled."):403===a.status?r=t("permission_denied","You do not have permission to perform this action."):404===a.status?r=t("resource_not_found","The requested resource was not found."):a.status>=500&&(r=t("server_error","Server error. Please try again later."))}catch(a){i.parseError=a.message}return this.logError("AJAX Error in "+s,i),this.showUserError(r),r}};var e={init:function(){this.bindEvents(),this.initEvaluationForm(),this.updateTotalScore(),this.initCharacterCount()},bindEvents:function(){var t=this;function n(t,n,e){a(t).on(n,e),window.mtEventListeners&&window.mtEventListeners.push({element:document,event:n,selector:t,handler:e})}n("#mt-evaluation-form","submit",function(a){t.submitEvaluation.call(t,a)}),n(".mt-score-slider","input",function(){t.updateScoreDisplay.call(this)}),n(".mt-score-mark","click",function(a){t.setScoreFromMark.call(this,a)}),n(".mt-evaluate-btn","click",function(a){t.loadEvaluation.call(t,a)}),n("#mt-comments","input",function(){t.updateCharCount.call(this)})},initEvaluationForm:function(){var a=new URLSearchParams(window.location.search).get("evaluate");a&&this.loadEvaluationForm(a)},loadEvaluation:function(n){n.preventDefault();var e=a(this).data("candidate-id");e?this.loadEvaluationForm(e):this.showError(t("invalid_candidate","Invalid candidate ID."))},loadEvaluationForm:function(n){var e=this;if("undefined"==typeof mt_ajax||!mt_ajax.nonce)return MTErrorHandler.logError("mt_ajax configuration missing",{mt_ajax_defined:"undefined"!=typeof mt_ajax,nonce_present:!(!mt_ajax||!mt_ajax.nonce)}),void MTErrorHandler.showUserError(t("security_error","Security configuration error. Please refresh the page and try again."));var s=a(".mt-jury-dashboard"),r=t("loading_evaluation","Loading evaluation form...");s.html('<div class="mt-loading">'+r+"</div>"),a.post(mt_ajax.ajax_url,{action:"mt_get_candidate_details",candidate_id:n,nonce:mt_ajax.nonce}).done(function(a){if(a.success){var t=a.data.data||a.data;e.displayEvaluationForm(t),e.loadExistingEvaluation(n)}else e.showError(a.data.message)}).fail(function(a,t,n){MTErrorHandler.handleAjaxError(a,t,n,"loadEvaluationForm - candidate details")})},displayEvaluationForm:function(n){var e=`\n                <div class="mt-evaluation-wrapper">\n                    <div class="mt-candidate-details">\n                        <h2>${n.name}</h2>\n                        <p class="mt-candidate-org">${n.organization||""}</p>\n                        ${n.photo_url?`<img src="${n.photo_url}" alt="${n.name}" class="mt-candidate-photo-eval">`:""}\n                        <div class="mt-candidate-bio">${n.bio}</div>\n                    </div>\n                    <form id="mt-evaluation-form" class="mt-evaluation-form">\n                        <input type="hidden" name="candidate_id" value="${n.id}">\n                        <div class="mt-criteria-section">\n                            <h3>${mt_frontend.i18n.evaluation_criteria||"Evaluation Criteria"}</h3>\n                            <div class="mt-criterion-card" data-criterion="courage">\n                                <div class="mt-criterion-header">\n                                    <span class="mt-criterion-icon dashicons dashicons-superhero"></span>\n                                    <h4 class="mt-criterion-label">${mt_frontend.i18n.mut_pioniergeist||"Mut & Pioniergeist"}</h4>\n                                </div>\n                                <p class="mt-criterion-description">${mt_frontend.i18n.mut_description||"Mut, Konventionen herauszufordern und neue Wege in der Mobilit√§t zu beschreiten"}</p>\n                                <div class="mt-score-slider-wrapper">\n                                    <input type="range" name="courage_score" class="mt-score-slider" min="0" max="10" value="5">\n                                    <div class="mt-score-marks">\n                                        <span class="mt-score-mark" data-value="0">0</span>\n                                        <span class="mt-score-mark" data-value="1">1</span>\n                                        <span class="mt-score-mark" data-value="2">2</span>\n                                        <span class="mt-score-mark" data-value="3">3</span>\n                                        <span class="mt-score-mark" data-value="4">4</span>\n                                        <span class="mt-score-mark" data-value="5">5</span>\n                                        <span class="mt-score-mark" data-value="6">6</span>\n                                        <span class="mt-score-mark" data-value="7">7</span>\n                                        <span class="mt-score-mark" data-value="8">8</span>\n                                        <span class="mt-score-mark" data-value="9">9</span>\n                                        <span class="mt-score-mark" data-value="10">10</span>\n                                    </div>\n                                </div>\n                                <div class="mt-score-display">\n                                    <span class="mt-score-value">5</span>\n                                </div>\n                            </div>\n                            <div class="mt-criterion-card" data-criterion="innovation">\n                                <div class="mt-criterion-header">\n                                    <span class="mt-criterion-icon dashicons dashicons-lightbulb"></span>\n                                    <h4 class="mt-criterion-label">${mt_frontend.i18n.innovationsgrad||"Innovationsgrad"}</h4>\n                                </div>\n                                <p class="mt-criterion-description">${mt_frontend.i18n.innovation_description||"Grad an Innovation und Kreativit√§t bei der L√∂sung von Mobilit√§tsherausforderungen"}</p>\n                                <div class="mt-score-slider-wrapper">\n                                    <input type="range" name="innovation_score" class="mt-score-slider" min="0" max="10" value="5">\n                                    <div class="mt-score-marks">\n                                        <span class="mt-score-mark" data-value="0">0</span>\n                                        <span class="mt-score-mark" data-value="1">1</span>\n                                        <span class="mt-score-mark" data-value="2">2</span>\n                                        <span class="mt-score-mark" data-value="3">3</span>\n                                        <span class="mt-score-mark" data-value="4">4</span>\n                                        <span class="mt-score-mark" data-value="5">5</span>\n                                        <span class="mt-score-mark" data-value="6">6</span>\n                                        <span class="mt-score-mark" data-value="7">7</span>\n                                        <span class="mt-score-mark" data-value="8">8</span>\n                                        <span class="mt-score-mark" data-value="9">9</span>\n                                        <span class="mt-score-mark" data-value="10">10</span>\n                                    </div>\n                                </div>\n                                <div class="mt-score-display">\n                                    <span class="mt-score-value">5</span>\n                                </div>\n                            </div>\n                            <div class="mt-criterion-card" data-criterion="implementation">\n                                <div class="mt-criterion-header">\n                                    <span class="mt-criterion-icon dashicons dashicons-hammer"></span>\n                                    <h4 class="mt-criterion-label">${mt_frontend.i18n.umsetzungskraft||"Umsetzungskraft & Wirkung"}</h4>\n                                </div>\n                                <p class="mt-criterion-description">${mt_frontend.i18n.umsetzung_description||"F√§higkeit zur Umsetzung und realer Einfluss der Initiativen"}</p>\n                                <div class="mt-score-slider-wrapper">\n                                    <input type="range" name="implementation_score" class="mt-score-slider" min="0" max="10" value="5">\n                                    <div class="mt-score-marks">\n                                        <span class="mt-score-mark" data-value="0">0</span>\n                                        <span class="mt-score-mark" data-value="1">1</span>\n                                        <span class="mt-score-mark" data-value="2">2</span>\n                                        <span class="mt-score-mark" data-value="3">3</span>\n                                        <span class="mt-score-mark" data-value="4">4</span>\n                                        <span class="mt-score-mark" data-value="5">5</span>\n                                        <span class="mt-score-mark" data-value="6">6</span>\n                                        <span class="mt-score-mark" data-value="7">7</span>\n                                        <span class="mt-score-mark" data-value="8">8</span>\n                                        <span class="mt-score-mark" data-value="9">9</span>\n                                        <span class="mt-score-mark" data-value="10">10</span>\n                                    </div>\n                                </div>\n                                <div class="mt-score-display">\n                                    <span class="mt-score-value">5</span>\n                                </div>\n                            </div>\n                            <div class="mt-criterion-card" data-criterion="relevance">\n                                <div class="mt-criterion-header">\n                                    <span class="mt-criterion-icon dashicons dashicons-location-alt"></span>\n                                    <h4 class="mt-criterion-label">${mt_frontend.i18n.relevanz||"Relevanz f√ºr die Mobilit√§tswende"}</h4>\n                                </div>\n                                <p class="mt-criterion-description">${mt_frontend.i18n.relevanz_description||"Bedeutung und Beitrag zur Transformation der Mobilit√§t"}</p>\n                                <div class="mt-score-slider-wrapper">\n                                    <input type="range" name="relevance_score" class="mt-score-slider" min="0" max="10" value="5">\n                                    <div class="mt-score-marks">\n                                        <span class="mt-score-mark" data-value="0">0</span>\n                                        <span class="mt-score-mark" data-value="1">1</span>\n                                        <span class="mt-score-mark" data-value="2">2</span>\n                                        <span class="mt-score-mark" data-value="3">3</span>\n                                        <span class="mt-score-mark" data-value="4">4</span>\n                                        <span class="mt-score-mark" data-value="5">5</span>\n                                        <span class="mt-score-mark" data-value="6">6</span>\n                                        <span class="mt-score-mark" data-value="7">7</span>\n                                        <span class="mt-score-mark" data-value="8">8</span>\n                                        <span class="mt-score-mark" data-value="9">9</span>\n                                        <span class="mt-score-mark" data-value="10">10</span>\n                                    </div>\n                                </div>\n                                <div class="mt-score-display">\n                                    <span class="mt-score-value">5</span>\n                                </div>\n                            </div>\n                            <div class="mt-criterion-card" data-criterion="visibility">\n                                <div class="mt-criterion-header">\n                                    <span class="mt-criterion-icon dashicons dashicons-visibility"></span>\n                                    <h4 class="mt-criterion-label">${mt_frontend.i18n.vorbildfunktion||"Vorbildfunktion & Sichtbarkeit"}</h4>\n                                </div>\n                                <p class="mt-criterion-description">${mt_frontend.i18n.vorbild_description||"Rolle als Vorbild und √∂ffentliche Wahrnehmbarkeit im Mobilit√§tssektor"}</p>\n                                <div class="mt-score-slider-wrapper">\n                                    <input type="range" name="visibility_score" class="mt-score-slider" min="0" max="10" value="5">\n                                    <div class="mt-score-marks">\n                                        <span class="mt-score-mark" data-value="0">0</span>\n                                        <span class="mt-score-mark" data-value="1">1</span>\n                                        <span class="mt-score-mark" data-value="2">2</span>\n                                        <span class="mt-score-mark" data-value="3">3</span>\n                                        <span class="mt-score-mark" data-value="4">4</span>\n                                        <span class="mt-score-mark" data-value="5">5</span>\n                                        <span class="mt-score-mark" data-value="6">6</span>\n                                        <span class="mt-score-mark" data-value="7">7</span>\n                                        <span class="mt-score-mark" data-value="8">8</span>\n                                        <span class="mt-score-mark" data-value="9">9</span>\n                                        <span class="mt-score-mark" data-value="10">10</span>\n                                    </div>\n                                </div>\n                                <div class="mt-score-display">\n                                    <span class="mt-score-value">5</span>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="mt-comments-section">\n                            <label for="mt-comments" class="mt-comments-label">${t("additional_comments","Additional Comments (Optional)")}</label>\n                            <textarea name="comments" id="mt-comments" class="mt-comments-textarea" rows="5"></textarea>\n                            <div class="mt-char-count">\n                                <span id="mt-char-current">0</span> / 1000 ${t("characters","characters")}\n                            </div>\n                        </div>\n                        <div class="mt-form-actions">\n                            <button type="submit" class="mt-btn mt-btn-primary">${t("submit_evaluation","Submit Evaluation")}</button>\n                            <a href="${window.location.pathname}" class="mt-btn mt-btn-secondary">${t("back_to_dashboard","Back to Dashboard")}</a>\n                        </div>\n                    </form>\n                </div>\n            `;a(".mt-jury-dashboard").html(e)},loadExistingEvaluation:function(n){"undefined"!=typeof mt_ajax&&mt_ajax.nonce?a.post(mt_ajax.ajax_url,{action:"mt_get_evaluation",candidate_id:n,nonce:mt_ajax.nonce}).done(function(n){if(n.success&&n.data.exists){var e=n.data.evaluation;a('input[name="courage_score"]').val(e.courage_score).trigger("input"),a('input[name="innovation_score"]').val(e.innovation_score).trigger("input"),a('input[name="implementation_score"]').val(e.implementation_score).trigger("input"),a('input[name="relevance_score"]').val(e.relevance_score).trigger("input"),a('input[name="visibility_score"]').val(e.visibility_score).trigger("input"),a('textarea[name="comments"]').val(e.comments),"completed"===e.status&&a(".mt-form-actions").prepend('<div class="mt-notice mt-notice-success">'+t("evaluation_submitted_editable","This evaluation has been submitted. You can still edit and resubmit.")+"</div>")}}):e.showError(t("security_error","Security configuration error. Please refresh the page and try again."))},updateScoreDisplay:function(){var t=a(this),n=t.val();t.closest(".mt-criterion-card").find(".mt-score-value").text(n);var s=n/10*100;t.css("background","linear-gradient(to right, #667eea 0%, #667eea "+s+"%, #e5e7eb "+s+"%, #e5e7eb 100%)"),e.updateTotalScore()},setScoreFromMark:function(t){t.preventDefault();var n=a(this),e=n.data("value");n.closest(".mt-criterion-card").find(".mt-score-slider").val(e).trigger("input")},updateTotalScore:function(){var n=0,e=0,s=0,r=a(".mt-score-slider");0===r.length&&(r=a('input[type="range"][name*="_score"]')),0===r.length&&(r=a('input[type="number"][name*="_score"]')),0===r.length&&(r=a('input[type="hidden"][name*="_score"]')),r.each(function(){var t=parseFloat(a(this).val());isNaN(t)||(n+=t,e++,t>0&&s++)});var i=e>0?(n/e).toFixed(1):"0.0",o=a("#mt-total-score");o.length&&o.text(i);var c=a(".mt-evaluated-count");if(c.length){var l="("+s+"/5 "+t("criteria_evaluated","criteria evaluated")+")";c.text(l)}},updateCharCount:function(){var t=a(this),n=t.val().length,e=1e3;a("#mt-char-current").text(n),n>e&&(t.val(t.val().substring(0,e)),a("#mt-char-current").text(e))},initCharacterCount:function(){var t=a("#mt-comments");t.length&&a("#mt-char-current").text(t.val().length)},refreshCriteriaContent:function(t){if(a(".mt-criteria-info-section").length>0){var n=window.location.href;n.includes("?")?n+="&refresh="+Date.now():n+="?refresh="+Date.now(),window.location.href=n}},isSubmittingEvaluation:!1,submitEvaluation:function(n){if(n.preventDefault(),this.isSubmittingEvaluation)return!1;if("undefined"!=typeof mt_ajax&&mt_ajax.nonce){this.isSubmittingEvaluation=!0;var s=this,r=a(n.target),i=r.find('button[type="submit"]'),o=!0,c=a(".mt-score-slider");if(0===c.length&&(c=a('input[name*="_score"]')),c.each(function(){var t=parseFloat(a(this).val());if(isNaN(t)||t<0||t>10)return o=!1,!1}),o){var l=t("submitting","Submitting...");i.prop("disabled",!0).html('<span class="dashicons dashicons-update mt-spin"></span> '+l);var d={},m=a("#mt-evaluation-form");0===m.length&&(m=a(".mt-evaluation-form")),0===m.length&&(m=r),m.find("input, textarea, select").each(function(){var t=a(this),n=t.attr("name"),e=t.val();n&&void 0!==e&&(d[n]=e)}),d.action="mt_submit_evaluation",d.nonce=mt_ajax.nonce,d.status="completed",a.post(mt_ajax.ajax_url,d).done(function(n){if(n.success){var r=n.data&&n.data.message?n.data.message:t("evaluation_submitted","Thank you for submitting your evaluation!");a(".mt-evaluation-header").after('<div class="mt-notice mt-notice-success">'+r+"</div>");var o=t("evaluation_submitted_status","Evaluation Submitted"),c=a(".mt-evaluation-title .mt-status-badge");c.length?c.removeClass("mt-status-draft").addClass("mt-status-completed").text(o):a(".mt-evaluation-title").append('<span class="mt-status-badge mt-status-completed">'+o+"</span>"),a("html, body").animate({scrollTop:0},300),i.prop("disabled",!1).html('<span class="dashicons dashicons-yes-alt"></span> '+t("submit_evaluation","Submit Evaluation")),window.mtTimeouts.evaluationRedirect&&clearTimeout(window.mtTimeouts.evaluationRedirect),window.mtTimeouts.evaluationRedirect=setTimeout(function(){window.location.href=window.location.pathname,delete window.mtTimeouts.evaluationRedirect},3e3)}else{var l=n.data&&n.data.message?n.data.message:t("error","An error occurred. Please try again.");e.showError(l),i.prop("disabled",!1).html('<span class="dashicons dashicons-yes-alt"></span> '+t("submit_evaluation","Submit Evaluation")),s.isSubmittingEvaluation=!1}}).fail(function(){e.showError(t("error","An error occurred. Please try again.")),i.prop("disabled",!1).html('<span class="dashicons dashicons-yes-alt"></span> '+t("submit_evaluation_btn",t("submit_evaluation","Submit Evaluation"))),s.isSubmittingEvaluation=!1})}else e.showError(t("invalid_scores","Please ensure all scores are between 0 and 10."))}else e.showError(t("security_error","Security configuration error. Please refresh the page and try again."))},showError:function(t){var n='<div class="mt-notice mt-notice-error">'+t+"</div>";a(".mt-evaluation-form").before(n),a("html, body").animate({scrollTop:0},300)}};if(a(document).ready(function(){e.init(),setTimeout(function(){e.updateTotalScore()},500),a(window).on("load",function(){e.updateTotalScore()})}),a(".mt-star-rating").length){function r(t,n){t.find(".mt-star").each(function(){var t=a(this).data("value");a(this).toggleClass("filled",t<=n)})}a(".mt-star-rating").each(function(){var t=a(this),n=t.find('input[type="hidden"]'),e=t.find(".mt-star");e.on("click",function(){var e=a(this).data("value");n.val(e).trigger("change"),r(t,e)}),e.on("mouseenter",function(){var n=a(this).data("value");r(t,n)}),t.on("mouseleave",function(){var a=n.val()||0;r(t,a)})})}function s(a,t){a.find(".mt-score-value").text(t)}a(document).on("click",".mt-star-rating .dashicons",function(){const t=a(this),n=t.data("value"),e=t.parent();e.find(".dashicons").removeClass("active"),e.find(".dashicons").each(function(){a(this).data("value")<=n&&a(this).addClass("active")}),e.find('input[type="hidden"]').val(n),s(t.closest(".mt-criterion-card"),n)}),a(document).on("input",".mt-score-input",function(){const t=Math.min(10,Math.max(0,a(this).val()));a(this).val(t),s(a(this).closest(".mt-criterion-card"),t)}),jQuery(document).ready(function(a){function t(){"undefined"!=typeof mt_ajax&&mt_ajax.ajax_url&&mt_ajax.nonce&&a.ajax({url:mt_ajax.ajax_url,type:"POST",data:{action:"mt_get_jury_rankings",nonce:mt_ajax.nonce,limit:10},success:function(t){t.success&&t.data.html&&(a("#mt-rankings-container").html(t.data.html),a(".mt-ranking-item").each(function(t){a(this).css("opacity","0").delay(50*t).animate({opacity:1},300)}))}})}a(document).on("mt:evaluation:submitted",function(){t()});window.mtIntervals||(window.mtIntervals={}),window.mtIntervals.rankingsRefresh&&clearInterval(window.mtIntervals.rankingsRefresh),window.mtIntervals.rankingsRefresh=setInterval(t,6e4)}),jQuery(document).ready(function(a){a(".mt-rankings-section").length&&a(".mt-score-ring-progress").each(function(){const t=a(this),n=t.css("stroke-dashoffset");t.css("stroke-dashoffset","100"),setTimeout(()=>{t.css("stroke-dashoffset",n)},100)}),a(document).on("mouseenter",".mt-ranking-item",function(){a(this).find(".mt-score-ring-progress").css("stroke","#764ba2")}).on("mouseleave",function(){a(this).find(".mt-score-ring-progress").css("stroke","#667eea")}),a(document).on("click",".mt-ranking-item",function(){a(this).css("transform","scale(0.98)"),setTimeout(()=>{a(this).css("transform","")},150)})}),jQuery(document).ready(function(a){function t(){a(".mt-score-ring-mini").each(function(){const t=a(this).data("score");n(a(this),t)}),a(document).on("click",".mt-score-adjust",function(t){t.preventDefault();const n=a(this),e=n.siblings(".mt-score-input"),s=n.data("action"),r=parseFloat(e.val())||0;let i=r;"increase"===s&&r<10?i=Math.min(10,r+.5):"decrease"===s&&r>0&&(i=Math.max(0,r-.5)),e.val(i).trigger("change")}),a(document).on("change",".mt-score-input",function(){const t=a(this),s=parseFloat(t.val())||0,r=Math.max(0,Math.min(10,s));s!==r&&t.val(r);n(t.closest(".mt-criterion-inline").find(".mt-score-ring-mini"),r),function(t){const n=[];if(t.find(".mt-score-input").each(function(){const t=parseFloat(a(this).val());isNaN(t)||n.push(t)}),n.length>0){const a=n.reduce((a,t)=>a+t,0)/n.length,s=t.find(".mt-total-score-display .score-value");s.text(a.toFixed(1)+"/10"),e(s,a)}}(t.closest(".mt-ranking-item"))}),a(document).on("click",".mt-btn-save-inline",function(t){t.preventDefault();const n=a(this),r=n.closest(".mt-inline-evaluation-form"),i=n.closest(".mt-ranking-item"),o=r.data("candidate-id");if(n.hasClass("saving"))return;const c={};if(r.find(".mt-score-input").each(function(){const t=a(this).attr("name"),n=a(this).val();t&&n&&(c[t]=n)}),n.addClass("saving"),i.addClass("updating"),"undefined"==typeof mt_ajax||!mt_ajax.nonce||!mt_ajax.ajax_url)return alert("Configuration error. Please refresh the page and try again."),void i.removeClass("updating");const l={action:"mt_save_inline_evaluation",nonce:mt_ajax.nonce,candidate_id:o,scores:c};a.ajax({url:mt_ajax.ajax_url,type:"POST",data:l,dataType:"json",success:function(a){if(a.success){i.removeClass("updating").addClass("success");const t=a.data.total_score,n=i.find(".mt-total-score-display .score-value");n.text(t.toFixed(1)+"/10"),n.data("score",t),e(n,t),setTimeout(function(){s()},1500),setTimeout(function(){i.removeClass("success")},2e3)}else alert(a.data||"Error saving evaluation"),i.removeClass("updating")},error:function(a,t,n){let e="Network error. Please try again.";try{a.responseJSON&&a.responseJSON.data&&(e=a.responseJSON.data)}catch(a){}alert(e),i.removeClass("updating")},complete:function(){n.removeClass("saving")}})})}function n(a,t){const n=a.find(".mt-ring-progress"),e=10*t+", 100";n.attr("stroke-dasharray",e),a.attr("data-score",t),t>=8?n.css("stroke","#22c55e"):t>=6?n.css("stroke","#667eea"):t>=4?n.css("stroke","#f59e0b"):n.css("stroke","#ef4444")}function e(a,t){t>=8?a.css("color","#22c55e"):t>=6?a.css("color","#667eea"):t>=4?a.css("color","#f59e0b"):a.css("color","#ef4444")}function s(){if("undefined"==typeof mt_ajax||!mt_ajax.ajax_url||!mt_ajax.nonce)return;const n=a("#mt-rankings-container");a.ajax({url:mt_ajax.ajax_url,type:"POST",data:{action:"mt_get_jury_rankings",nonce:mt_ajax.nonce,limit:10},success:function(e){if(e.success&&e.data.html){const s={};a(".mt-inline-evaluation-form").each(function(){const t=a(this).data("candidate-id");s[t]={},a(this).find(".mt-score-input").each(function(){const n=a(this).attr("name");s[t][n]=a(this).val()})}),n.fadeOut(300,function(){a(this).html(e.data.html).fadeIn(300,function(){t()})})}},error:function(){}})}t(),a(".mt-rankings-section").length>0&&(window.mtIntervals||(window.mtIntervals={}),window.mtIntervals.inlineRankingsRefresh&&clearInterval(window.mtIntervals.inlineRankingsRefresh),window.mtIntervals.inlineRankingsRefresh=setInterval(s,3e4))})}(jQuery),function(a){a(document).ready(function(){var t=a(".mt-evaluation-table");function n(t){var n=0,e=0;t.find(".mt-eval-score-input").each(function(){var t=parseFloat(a(this).val());isNaN(t)||(n+=t,e++)});var s=e>0?n/e:0;t.find(".mt-eval-total-value").text(s.toFixed(1));var r=t.find(".mt-eval-total-score");r.removeClass("score-high score-low"),s>=8?r.addClass("score-high"):s<=3&&r.addClass("score-low")}function e(a){var t=parseFloat(a.val());a.removeClass("score-high score-low"),t>=8?a.addClass("score-high"):t<=3&&a.addClass("score-low")}t.length&&(t.on("input change",".mt-eval-score-input",function(){var t=a(this),s=t.closest("tr");e(t),n(s),s.addClass("unsaved").removeClass("saving"),s.find(".mt-btn-save-eval").addClass("unsaved").removeClass("saving")}),t.on("click",".mt-btn-save-eval",function(t){t.preventDefault();var n=a(this),e=n.closest("tr");if(!n.hasClass("saving")){n.addClass("saving").removeClass("unsaved"),e.addClass("saving").removeClass("unsaved"),n.html('<span class="mt-eval-spinner"></span> '+getI18nText("saving","Saving..."));var s=n.data("candidate-id"),r={};e.find(".mt-eval-score-input").each(function(){var t=a(this).attr("name"),n=a(this).val();r[t]=n});var i={action:"mt_save_inline_evaluation",nonce:"undefined"!=typeof mt_ajax&&mt_ajax.nonce?mt_ajax.nonce:"",candidate_id:s,scores:r,context:"table"};a.ajax({url:"undefined"!=typeof mt_ajax&&mt_ajax.ajax_url?mt_ajax.ajax_url:"",type:"POST",data:i,dataType:"json",success:function(a){if(a.success){if(e.removeClass("unsaved saving").addClass("saved"),n.removeClass("saving").html('<span class="dashicons dashicons-saved"></span> '+getI18nText("saved","Saved")),setTimeout(function(){n.html('<span class="dashicons dashicons-saved"></span> '+getI18nText("save","Save")),e.removeClass("saved")},1200),a.data&&void 0!==a.data.total_score){var t=parseFloat(a.data.total_score);e.find(".mt-eval-total-value").text(t.toFixed(1)),e.data("total-score",t),"function"==typeof rerankTable&&setTimeout(rerankTable,300)}}else{var s="";a&&a.data&&("string"==typeof a.data?s=a.data:a.data.message?s=a.data.message:a.data.errors&&(s=a.data.errors.join(", "))),s=s||getI18nText("error_saving_evaluation","Error saving evaluation"),n.removeClass("saving").addClass("unsaved").html('<span class="dashicons dashicons-warning"></span> '+getI18nText("error","Error")),e.removeClass("saving").addClass("unsaved"),setTimeout(function(){n.html('<span class="dashicons dashicons-saved"></span> '+getI18nText("save","Save"))},2e3),window.MTErrorHandler?MTErrorHandler.showUserError(s):alert(s)}},error:function(a,t,s){n.removeClass("saving").addClass("unsaved").html('<span class="dashicons dashicons-warning"></span> '+getI18nText("error","Error")),e.removeClass("saving").addClass("unsaved"),setTimeout(function(){n.html('<span class="dashicons dashicons-saved"></span> '+getI18nText("save","Save"))},2e3);var r=getI18nText("network_error","Network error. Please try again.");if(a.responseJSON&&a.responseJSON.data)r=a.responseJSON.data;else if(a.responseText)try{var i=JSON.parse(a.responseText);i.data&&(r=i.data)}catch(a){}window.MTErrorHandler?MTErrorHandler.handleAjaxError(a,t,s,"jury-rankings-table"):alert(r)}})}}),t.find("th[title]").each(function(){var t=a(this);t.attr("tabindex","0"),t.on("focus mouseenter",function(){var n=t.attr("title");if(n){var e=a('<div class="mt-tooltip"></div>').text(n).appendTo("body"),s=t.offset();e.css({top:s.top+t.outerHeight()+4,left:s.left+t.outerWidth()/2-e.outerWidth()/2}),t.data("mt-tooltip",e)}}),t.on("blur mouseleave",function(){var a=t.data("mt-tooltip");a&&a.remove()})}),t.find("tbody tr").each(function(){var t=a(this);t.find(".mt-eval-score-input").each(function(){e(a(this))}),n(t)}))})}(jQuery);