!function(t,e){"use strict";t.MTRichEditor={config:{maxHistorySize:50,autosaveInterval:3e4,supportedTags:["p","br","strong","b","em","i","u","h1","h2","h3","ul","ol","li","a","blockquote"],toolbarButtons:[]},getToolbarButtons:function(){var e=(t.mt_editor_i18n||{}).toolbar||{};return[{command:"bold",icon:"dashicons-editor-bold",title:e.bold||"Bold (Ctrl+B)",shortcut:"Ctrl+B"},{command:"italic",icon:"dashicons-editor-italic",title:e.italic||"Italic (Ctrl+I)",shortcut:"Ctrl+I"},{command:"underline",icon:"dashicons-editor-underline",title:e.underline||"Underline (Ctrl+U)",shortcut:"Ctrl+U"},{type:"separator"},{command:"heading",icon:"dashicons-heading",title:e.headings||"Headings",type:"dropdown"},{type:"separator"},{command:"insertUnorderedList",icon:"dashicons-editor-ul",title:e.unordered_list||"Bullet List"},{command:"insertOrderedList",icon:"dashicons-editor-ol",title:e.ordered_list||"Numbered List"},{type:"separator"},{command:"createLink",icon:"dashicons-admin-links",title:e.insert_link||"Insert Link (Ctrl+K)",shortcut:"Ctrl+K"},{command:"unlink",icon:"dashicons-editor-unlink",title:e.remove_link||"Remove Link"},{type:"separator"},{command:"removeFormat",icon:"dashicons-editor-removeformatting",title:e.remove_format||"Clear Formatting"},{type:"separator"},{command:"undo",icon:"dashicons-undo",title:e.undo||"Undo (Ctrl+Z)",shortcut:"Ctrl+Z"},{command:"redo",icon:"dashicons-redo",title:e.redo||"Redo (Ctrl+Y)",shortcut:"Ctrl+Y"}]},editors:{},history:{},historyIndex:{},isSupported:function(){return"contentEditable"in e.body&&"function"==typeof e.execCommand},init:function(t,n){if(n=n||{},!this.isSupported())return this.initFallback(t,n);const o=e.getElementById(t);if(!o)return null;const i=this.createEditorStructure(t,n);o.innerHTML="",o.appendChild(i);const r=i.querySelector(".mt-rich-editor-content");return this.editors[t]=r,this.history[t]=[],this.historyIndex[t]=-1,n.content&&(r.innerHTML=this.sanitizeHTML(n.content),this.saveHistory(t)),this.bindEditorEvents(t,r),this.bindToolbarEvents(t,i),n.autosave&&n.onAutosave&&this.startAutosave(t,n.onAutosave),r},createEditorStructure:function(t,n){const o=e.createElement("div");o.className="mt-rich-editor-wrapper",o.setAttribute("data-editor-id",t);const i=this.createToolbar(t);o.appendChild(i);const r=e.createElement("div");r.className="mt-rich-editor-content",r.contentEditable=!0,r.setAttribute("role","textbox"),r.setAttribute("aria-multiline","true"),r.setAttribute("aria-label",n.label||"Rich text editor"),n.minHeight&&(r.style.minHeight=n.minHeight+"px"),n.maxHeight&&(r.style.maxHeight=n.maxHeight+"px"),o.appendChild(r);const a=e.createElement("div");return a.className="mt-rich-editor-status",a.innerHTML='<span class="mt-char-count">0 characters</span>',o.appendChild(a),o},createToolbar:function(t){const n=e.createElement("div");n.className="mt-rich-editor-toolbar",n.setAttribute("role","toolbar");return this.getToolbarButtons().forEach(t=>{if("separator"===t.type){const t=e.createElement("span");t.className="mt-toolbar-separator",n.appendChild(t)}else if("dropdown"===t.type){const e=this.createDropdown(t);n.appendChild(e)}else{const e=this.createToolbarButton(t);n.appendChild(e)}}),n},createToolbarButton:function(t){const n=e.createElement("button");n.type="button",n.className="mt-toolbar-button",n.setAttribute("data-command",t.command),n.setAttribute("title",t.title),n.setAttribute("aria-label",t.title);const o=e.createElement("span");return o.className="dashicons "+t.icon,n.appendChild(o),n},createDropdown:function(n){const o=e.createElement("div");o.className="mt-toolbar-dropdown";const i=e.createElement("button");i.type="button",i.className="mt-toolbar-button mt-dropdown-toggle",i.setAttribute("data-command",n.command),i.setAttribute("title",n.title);const r=e.createElement("span");r.className="dashicons "+n.icon,i.appendChild(r);const a=e.createElement("div");a.className="mt-dropdown-menu";var s=(t.mt_editor_i18n||{}).dropdown||{};return a.innerHTML=`\n                <button type="button" data-heading="p">${s.normal_text||"Normal Text"}</button>\n                <button type="button" data-heading="h1">${s.heading_1||"Heading 1"}</button>\n                <button type="button" data-heading="h2">${s.heading_2||"Heading 2"}</button>\n                <button type="button" data-heading="h3">${s.heading_3||"Heading 3"}</button>\n            `,o.appendChild(i),o.appendChild(a),o},bindEditorEvents:function(t,e){const n=this;e.addEventListener("input",function(){n.updateCharCount(t),n.saveHistory(t)}),e.addEventListener("keydown",function(e){n.handleKeyboardShortcuts(e,t)}),e.addEventListener("paste",function(e){n.handlePaste(e,t)}),e.addEventListener("focus",function(){this.parentElement.classList.add("focused")}),e.addEventListener("blur",function(){this.parentElement.classList.remove("focused")})},bindToolbarEvents:function(t,n){const o=this,i=n.querySelector(".mt-rich-editor-toolbar");i.querySelectorAll(".mt-toolbar-button:not(.mt-dropdown-toggle)").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("data-command");o.executeCommand(t,n)})}),i.querySelectorAll(".mt-dropdown-toggle").forEach(t=>{t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();this.nextElementSibling.classList.toggle("show")})}),i.querySelectorAll(".mt-dropdown-menu button").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("data-heading");o.formatHeading(t,n),this.parentElement.classList.remove("show")})}),e.addEventListener("click",function(){i.querySelectorAll(".mt-dropdown-menu.show").forEach(t=>{t.classList.remove("show")})})},executeCommand:function(t,n,o){const i=this.editors[t];if(i){switch(i.focus(),n){case"createLink":this.insertLink(t);break;case"undo":this.undo(t);break;case"redo":this.redo(t);break;case"removeFormat":e.execCommand("removeFormat",!1,null),e.execCommand("formatBlock",!1,"p");break;default:e.execCommand(n,!1,o||null)}this.saveHistory(t),this.updateToolbarState(t)}},formatHeading:function(t,n){const o=this.editors[t];o&&(o.focus(),e.execCommand("formatBlock",!1,n),this.saveHistory(t),this.updateToolbarState(t))},insertLink:function(n){var o=(t.mt_editor_i18n||{}).prompts||{};const i=prompt(o.enter_url||"Enter URL:","https://");if(i&&"https://"!==i){e.execCommand("createLink",!1,i);this.editors[n].querySelectorAll('a[href="'+i+'"]').forEach(t=>{t.target="_blank",t.rel="noopener noreferrer"})}},handleKeyboardShortcuts:function(t,e){if(t.ctrlKey||t.metaKey)switch(t.key.toLowerCase()){case"b":t.preventDefault(),this.executeCommand(e,"bold");break;case"i":t.preventDefault(),this.executeCommand(e,"italic");break;case"u":t.preventDefault(),this.executeCommand(e,"underline");break;case"k":t.preventDefault(),this.executeCommand(e,"createLink");break;case"z":t.shiftKey||(t.preventDefault(),this.undo(e));break;case"y":t.preventDefault(),this.redo(e)}},handlePaste:function(n,o){n.preventDefault();let i="";n.clipboardData?i=n.clipboardData.getData("text/html")||n.clipboardData.getData("text/plain"):t.clipboardData&&(i=t.clipboardData.getData("Text"));const r=this.sanitizeHTML(i);e.execCommand("insertHTML",!1,r),this.saveHistory(o)},sanitizeHTML:function(t){const n=e.createElement("div");return n.innerHTML=t,n.querySelectorAll("script, style, meta, link").forEach(t=>t.remove()),n.querySelectorAll("*").forEach(t=>{const e=["href","target","rel","title","alt"];Array.from(t.attributes).forEach(n=>{e.includes(n.name)||n.name.startsWith("data-")||t.removeAttribute(n.name)});for(let e in t)e.startsWith("on")&&(t[e]=null)}),n.querySelectorAll("p").forEach(t=>{t.textContent.trim()||t.querySelector("br")||t.remove()}),n.innerHTML},saveHistory:function(t){const e=this.editors[t];if(!e)return;const n=e.innerHTML,o=this.history[t],i=this.historyIndex[t];o.splice(i+1),o.push(n),o.length>this.config.maxHistorySize&&o.shift(),this.historyIndex[t]=o.length-1},undo:function(t){const e=this.history[t];let n=this.historyIndex[t];n>0&&(n--,this.historyIndex[t]=n,this.editors[t].innerHTML=e[n],this.updateToolbarState(t))},redo:function(t){const e=this.history[t];let n=this.historyIndex[t];n<e.length-1&&(n++,this.historyIndex[t]=n,this.editors[t].innerHTML=e[n],this.updateToolbarState(t))},updateToolbarState:function(t){const n=e.querySelector('[data-editor-id="'+t+'"]');if(!n)return;const o=n.querySelector(".mt-rich-editor-toolbar");o.querySelectorAll(".mt-toolbar-button").forEach(t=>{const n=t.getAttribute("data-command");if(n&&"undo"!==n&&"redo"!==n){const o=e.queryCommandState(n);t.classList.toggle("active",o)}});const i=o.querySelector('[data-command="undo"]'),r=o.querySelector('[data-command="redo"]');i&&(i.disabled=this.historyIndex[t]<=0),r&&(r.disabled=this.historyIndex[t]>=this.history[t].length-1)},updateCharCount:function(t){const n=this.editors[t],o=e.querySelector('[data-editor-id="'+t+'"]');if(!n||!o)return;const i=n.textContent.length,r=o.querySelector(".mt-char-count");r&&(r.textContent=i+" characters")},getContent:function(t){const e=this.editors[t];return e?this.sanitizeHTML(e.innerHTML):""},setContent:function(t,e){const n=this.editors[t];n&&(n.innerHTML=this.sanitizeHTML(e),this.saveHistory(t),this.updateCharCount(t))},startAutosave:function(t,e){const n=this;setInterval(function(){const o=n.getContent(t);o&&e(o)},this.config.autosaveInterval)},initFallback:function(t,n){const o=e.getElementById(t);if(!o)return null;const i=e.createElement("textarea");i.className="mt-rich-editor-fallback",i.id=t+"-fallback",i.rows=10,n.content&&(i.value=this.stripHTML(n.content)),o.innerHTML="",o.appendChild(i);const r=e.createElement("div");return r.className="mt-editor-help",r.innerHTML="Use **text** for bold, *text* for italic, and [text](url) for links.",o.appendChild(r),i},stripHTML:function(t){const n=e.createElement("div");return n.innerHTML=t,n.textContent||n.innerText||""},destroy:function(t){delete this.editors[t],delete this.history[t],delete this.historyIndex[t];const n=e.getElementById(t);n&&(n.innerHTML="")}}}(window,document);